<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Authentication and Authorization for Constrained Environments (ACE)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Overview"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 OAuth 2.0"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 CoAP"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Protocol Interactions"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Framework"/>
<link href="#rfc.section.6" rel="Chapter" title="6 The 'Token' Endpoint"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Client-to-AS Request"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 AS-to-Client Response"/>
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Error Response"/>
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 New Request and Response Parameters"/>
<link href="#rfc.section.6.4.1" rel="Chapter" title="6.4.1 Audience"/>
<link href="#rfc.section.6.4.2" rel="Chapter" title="6.4.2 Grant Type"/>
<link href="#rfc.section.6.4.3" rel="Chapter" title="6.4.3 Token Type"/>
<link href="#rfc.section.6.4.4" rel="Chapter" title="6.4.4 Profile"/>
<link href="#rfc.section.6.4.5" rel="Chapter" title="6.4.5 Confirmation"/>
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 Mapping parameters to CBOR"/>
<link href="#rfc.section.7" rel="Chapter" title="7 The 'Introspect' Endpoint"/>
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 RS-to-AS Request"/>
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 AS-to-RS Response"/>
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Error Response"/>
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Client Token"/>
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 Mapping Introspection parameters to CBOR"/>
<link href="#rfc.section.8" rel="Chapter" title="8 The Access Token"/>
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 The 'Authorization Information' Endpoint"/>
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Token Expiration"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Security Considerations"/>
<link href="#rfc.section.10" rel="Chapter" title="10 IANA Considerations"/>
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 OAuth Introspection Response Parameter Registration"/>
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 OAuth Parameter Registration"/>
<link href="#rfc.section.10.3" rel="Chapter" title="10.3 OAuth Access Token Types"/>
<link href="#rfc.section.10.4" rel="Chapter" title="10.4 Token Type Mappings"/>
<link href="#rfc.section.10.4.1" rel="Chapter" title="10.4.1 Registration Template"/>
<link href="#rfc.section.10.4.2" rel="Chapter" title="10.4.2 Initial Registry Contents"/>
<link href="#rfc.section.10.5" rel="Chapter" title="10.5 CBOR Web Token Claims"/>
<link href="#rfc.section.10.6" rel="Chapter" title="10.6 ACE Profile Registry"/>
<link href="#rfc.section.10.6.1" rel="Chapter" title="10.6.1 Registration Template"/>
<link href="#rfc.section.10.7" rel="Chapter" title="10.7 OAuth Parameter Mappings Registry"/>
<link href="#rfc.section.10.7.1" rel="Chapter" title="10.7.1 Registration Template"/>
<link href="#rfc.section.10.7.2" rel="Chapter" title="10.7.2 Initial Registry Contents"/>
<link href="#rfc.section.10.8" rel="Chapter" title="10.8 Introspection Endpoint CBOR Mappings Registry"/>
<link href="#rfc.section.10.8.1" rel="Chapter" title="10.8.1 Registration Template"/>
<link href="#rfc.section.10.8.2" rel="Chapter" title="10.8.2 Initial Registry Contents"/>
<link href="#rfc.section.10.9" rel="Chapter" title="10.9 CoAP Option Number Registration"/>
<link href="#rfc.section.11" rel="Chapter" title="11 Acknowledgments"/>
<link href="#rfc.references" rel="Chapter" title="12 References"/>
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Design Justification"/>
<link href="#rfc.appendix.B" rel="Chapter" title="B Roles and Responsibilites"/>
<link href="#rfc.appendix.C" rel="Chapter" title="C Requirements on Profiles"/>
<link href="#rfc.appendix.D" rel="Chapter" title="D Deployment Examples"/>
<link href="#rfc.appendix.D.1" rel="Chapter" title="D.1 Local Token Validation"/>
<link href="#rfc.appendix.D.2" rel="Chapter" title="D.2 Introspection Aided Token Validation"/>
<link href="#rfc.appendix.E" rel="Chapter" title="E Document Updates"/>
<link href="#rfc.appendix.E.1" rel="Chapter" title="E.1 Version -02 to -03"/>
<link href="#rfc.appendix.E.2" rel="Chapter" title="E.2 Version -01 to -02"/>
<link href="#rfc.appendix.E.3" rel="Chapter" title="E.3 Version -00 to -01"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Seitz, L., Selander, G., Wahlstroem, E., Erdtman, S., and H. Tschofenig" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-ace-oauth-authz-04" />
  <meta name="dct.issued" scheme="ISO8601" content="2016-10-31" />
  <meta name="dct.abstract" content="This specification defines a framework for authentication and authorization in Internet of Things (IoT) environments. The framework is based on a set of building blocks including OAuth 2.0 and CoAP, thus making a well-known and widely used authorization solution suitable for IoT devices.  Existing specifications are used where possible, but where the constraints of IoT devices require it, extensions are added and profiles are defined.  " />
  <meta name="description" content="This specification defines a framework for authentication and authorization in Internet of Things (IoT) environments. The framework is based on a set of building blocks including OAuth 2.0 and CoAP, thus making a well-known and widely used authorization solution suitable for IoT devices.  Existing specifications are used where possible, but where the constraints of IoT devices require it, extensions are added and profiles are defined.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">ACE Working Group</td>
  <td class="right">L. Seitz</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">SICS</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">G. Selander</td>
</tr>
<tr>
  <td class="left">Expires: May 4, 2017</td>
  <td class="right">Ericsson</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">E. Wahlstroem</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right"></td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">S. Erdtman</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Spotify AB</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">H. Tschofenig</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">ARM Ltd.</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">October 31, 2016</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Authentication and Authorization for Constrained Environments (ACE)<br />
  <span class="filename">draft-ietf-ace-oauth-authz-04</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This specification defines a framework for authentication and authorization in Internet of Things (IoT) environments. The framework is based on a set of building blocks including OAuth 2.0 and CoAP, thus making a well-known and widely used authorization solution suitable for IoT devices.  Existing specifications are used where possible, but where the constraints of IoT devices require it, extensions are added and profiles are defined.  </p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 4, 2017.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2016 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">Terminology</a></li>
<li>3.   <a href="#rfc.section.3">Overview</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">OAuth 2.0</a></li>
<li>3.2.   <a href="#rfc.section.3.2">CoAP</a></li>
</ul><li>4.   <a href="#rfc.section.4">Protocol Interactions</a></li>
<li>5.   <a href="#rfc.section.5">Framework</a></li>
<li>6.   <a href="#rfc.section.6">The 'Token' Endpoint</a></li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Client-to-AS Request</a></li>
<li>6.2.   <a href="#rfc.section.6.2">AS-to-Client Response</a></li>
<li>6.3.   <a href="#rfc.section.6.3">Error Response</a></li>
<li>6.4.   <a href="#rfc.section.6.4">New Request and Response Parameters</a></li>
<ul><li>6.4.1.   <a href="#rfc.section.6.4.1">Audience</a></li>
<li>6.4.2.   <a href="#rfc.section.6.4.2">Grant Type</a></li>
<li>6.4.3.   <a href="#rfc.section.6.4.3">Token Type</a></li>
<li>6.4.4.   <a href="#rfc.section.6.4.4">Profile</a></li>
<li>6.4.5.   <a href="#rfc.section.6.4.5">Confirmation</a></li>
</ul><li>6.5.   <a href="#rfc.section.6.5">Mapping parameters to CBOR</a></li>
</ul><li>7.   <a href="#rfc.section.7">The 'Introspect' Endpoint</a></li>
<ul><li>7.1.   <a href="#rfc.section.7.1">RS-to-AS Request</a></li>
<li>7.2.   <a href="#rfc.section.7.2">AS-to-RS Response</a></li>
<li>7.3.   <a href="#rfc.section.7.3">Error Response</a></li>
<li>7.4.   <a href="#rfc.section.7.4">Client Token</a></li>
<li>7.5.   <a href="#rfc.section.7.5">Mapping Introspection parameters to CBOR</a></li>
</ul><li>8.   <a href="#rfc.section.8">The Access Token</a></li>
<ul><li>8.1.   <a href="#rfc.section.8.1">The 'Authorization Information' Endpoint</a></li>
<li>8.2.   <a href="#rfc.section.8.2">Token Expiration</a></li>
</ul><li>9.   <a href="#rfc.section.9">Security Considerations</a></li>
<li>10.   <a href="#rfc.section.10">IANA Considerations</a></li>
<ul><li>10.1.   <a href="#rfc.section.10.1">OAuth Introspection Response Parameter Registration</a></li>
<li>10.2.   <a href="#rfc.section.10.2">OAuth Parameter Registration</a></li>
<li>10.3.   <a href="#rfc.section.10.3">OAuth Access Token Types</a></li>
<li>10.4.   <a href="#rfc.section.10.4">Token Type Mappings</a></li>
<ul><li>10.4.1.   <a href="#rfc.section.10.4.1">Registration Template</a></li>
<li>10.4.2.   <a href="#rfc.section.10.4.2">Initial Registry Contents</a></li>
</ul><li>10.5.   <a href="#rfc.section.10.5">CBOR Web Token Claims</a></li>
<li>10.6.   <a href="#rfc.section.10.6">ACE Profile Registry</a></li>
<ul><li>10.6.1.   <a href="#rfc.section.10.6.1">Registration Template</a></li>
</ul><li>10.7.   <a href="#rfc.section.10.7">OAuth Parameter Mappings Registry</a></li>
<ul><li>10.7.1.   <a href="#rfc.section.10.7.1">Registration Template</a></li>
<li>10.7.2.   <a href="#rfc.section.10.7.2">Initial Registry Contents</a></li>
</ul><li>10.8.   <a href="#rfc.section.10.8">Introspection Endpoint CBOR Mappings Registry</a></li>
<ul><li>10.8.1.   <a href="#rfc.section.10.8.1">Registration Template</a></li>
<li>10.8.2.   <a href="#rfc.section.10.8.2">Initial Registry Contents</a></li>
</ul><li>10.9.   <a href="#rfc.section.10.9">CoAP Option Number Registration</a></li>
</ul><li>11.   <a href="#rfc.section.11">Acknowledgments</a></li>
<li>12.   <a href="#rfc.references">References</a></li>
<ul><li>12.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>12.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Design Justification</a></li>
<li>Appendix B.   <a href="#rfc.appendix.B">Roles and Responsibilites</a></li>
<li>Appendix C.   <a href="#rfc.appendix.C">Requirements on Profiles</a></li>
<li>Appendix D.   <a href="#rfc.appendix.D">Deployment Examples</a></li>
<ul><li>D.1.   <a href="#rfc.appendix.D.1">Local Token Validation</a></li>
<li>D.2.   <a href="#rfc.appendix.D.2">Introspection Aided Token Validation</a></li>
</ul><li>Appendix E.   <a href="#rfc.appendix.E">Document Updates</a></li>
<ul><li>E.1.   <a href="#rfc.appendix.E.1">Version -02 to -03</a></li>
<li>E.2.   <a href="#rfc.appendix.E.2">Version -01 to -02</a></li>
<li>E.3.   <a href="#rfc.appendix.E.3">Version -00 to -01</a></li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a></h1>
<p id="rfc.section.1.p.1">Authorization is the process for granting approval to an entity to access a resource <a href="#RFC4949">[RFC4949]</a>. The authorization task itself can best be described as granting access to a requesting client, for a resource hosted on a device, the resource server (RS).  This exchange is mediated by one or multiple authorization servers (AS). Managing authorization for a large number of devices and users is a complex task. </p>
<p id="rfc.section.1.p.2">While prior work on authorization solutions for the Web and for the mobile environment also applies to the IoT environment many IoT devices are constrained, for example in terms of processing capabilities, available memory, etc.  For web applications on constrained nodes this specification makes use of CoAP <a href="#RFC7252">[RFC7252]</a>.</p>
<p id="rfc.section.1.p.3">A detailed treatment of constraints can be found in <a href="#RFC7228">[RFC7228]</a>, and the different IoT deployments present a continuous range of device and network capabilities.  Taking energy consumption as an example: At one end there are energy-harvesting or battery powered devices which have a tight power budget, on the other end there are mains-powered devices, and all levels in between.</p>
<p id="rfc.section.1.p.4">Hence, IoT devices may be very different in terms of available processing and message exchange capabilities and there is a need to support many different authorization use cases <a href="#RFC7744">[RFC7744]</a>.</p>
<p id="rfc.section.1.p.5">This specification describes a framework for authentication and authorization in constrained environments (ACE) built on re-use of OAuth 2.0 <a href="#RFC6749">[RFC6749]</a>, thereby extending authorization to Internet of Things devices.  This specification contains the necessary building blocks for adjusting OAuth 2.0 to IoT environments.</p>
<p id="rfc.section.1.p.6">More detailed, interoperable specifications can be found in profiles.  Implementations may claim conformance with a specific profile, whereby implementations utilizing the same profile interoperate while implementations of different profiles are not expected to be interoperable.  Some devices, such as mobile phones and tablets, may implement multiple profiles and will therefore be able to interact with a wider range of low end devices.  </p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#terminology" id="terminology">Terminology</a></h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.  </p>
<p id="rfc.section.2.p.2">Certain security-related terms such as "authentication", "authorization", "confidentiality", "(data) integrity", "message authentication code", and "verify" are taken from <a href="#RFC4949">[RFC4949]</a>.  </p>
<p id="rfc.section.2.p.3">Since we describe exchanges as RESTful protocol interactions HTTP <a href="#RFC7231">[RFC7231]</a> offers useful terminology.  </p>
<p id="rfc.section.2.p.4">Terminology for entities in the architecture is defined in OAuth 2.0 <a href="#RFC6749">[RFC6749]</a> and <a href="#I-D.ietf-ace-actors">[I-D.ietf-ace-actors]</a>, such as client (C), resource server (RS), and authorization server (AS).</p>
<p id="rfc.section.2.p.5">Note that the term "endpoint" is used here following its OAuth definition, which is to denote resources such as /token and /introspect at the AS and /authz-info at the RS.  The CoAP <a href="#RFC7252">[RFC7252]</a> definition, which is "An entity participating in the CoAP protocol" is not used in this memo.</p>
<p id="rfc.section.2.p.6">Since this specification focuses on the problem of access control to resources, we simplify the actors by assuming that the client authorization server (CAS) functionality is not stand-alone but subsumed by either the authorization server or the client (see section 2.2 in <a href="#I-D.ietf-ace-actors">[I-D.ietf-ace-actors]</a>).  </p>
<p id="rfc.section.2.p.7">We call the specifications of this memo the "framework" or "ACE framework".  When referring to "profiles of this framework" we mean additional memo's that define the use of this specification with concrete transport, and communication security protocols (e.g. CoAP over DTLS).  </p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#overview" id="overview">Overview</a></h1>
<p id="rfc.section.3.p.1">This specification defines the ACE framework for authorization in the Internet of Things environment. It consists of a set of building blocks.</p>
<p id="rfc.section.3.p.2">The basic block is the OAuth 2.0 <a href="#RFC6749">[RFC6749]</a> framework, which enjoys widespread deployment.  Many IoT devices can support OAuth 2.0 without any additional extensions, but for certain constrained settings additional profiling is needed.  </p>
<p id="rfc.section.3.p.3">Another building block is the lightweight web transfer protocol CoAP <a href="#RFC7252">[RFC7252]</a> for those communication environments where HTTP is not appropriate.  CoAP typically runs on top of UDP which further reduces overhead and message exchanges. While this specification defines extensions for the use of OAuth over CoAP, we do envision further underlying protocols to be supported in the future, such as HTTP/2, MQTT and QUIC.</p>
<p id="rfc.section.3.p.4">A third building block is CBOR <a href="#RFC7049">[RFC7049]</a> for encodings where JSON <a href="#RFC7159">[RFC7159]</a> is not sufficiently compact.  CBOR is a binary encoding designed for small code and message size, which may be used for encoding of self contained tokens, and also for encoding CoAP POST parameters and CoAP responses.  </p>
<p id="rfc.section.3.p.5">A fourth building block is the compact CBOR-based secure message format COSE <a href="#I-D.ietf-cose-msg">[I-D.ietf-cose-msg]</a>, which enables application layer security as an alternative or complement to transport layer security (DTLS <a href="#RFC6347">[RFC6347]</a> or TLS <a href="#RFC5246">[RFC5246]</a>). COSE is used to secure self contained tokens such as proof-of-possession (PoP) tokens, which is an extension to the OAuth access tokens, and "client tokens" which are defined in this framework (see <a href="#clientToken">Section 7.4</a>). The default access token format is defined in CBOR web token (CWT) <a href="#I-D.ietf-ace-cbor-web-token">[I-D.ietf-ace-cbor-web-token]</a>.  Application layer security for CoAP using COSE can be provided with OSCOAP <a href="#I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</a>.</p>
<p id="rfc.section.3.p.6">With the building blocks listed above, solutions satisfying various IoT device and network constraints are possible.  A list of constraints is described in detail in RFC 7228 <a href="#RFC7228">[RFC7228]</a> and a description of how the building blocks mentioned above relate to the various constraints can be found in <a href="#constraints">Appendix A</a>.</p>
<p id="rfc.section.3.p.7">Luckily, not every IoT device suffers from all constraints.  The ACE framework nevertheless takes all these aspects into account and allows several different deployment variants to co-exist rather than mandating a one-size-fits-all solution.  We believe this is important to cover the wide range of possible interworking use cases and the different requirements from a security point of view.  Once IoT deployments mature, popular deployment variants will be documented in form of ACE profiles.</p>
<p id="rfc.section.3.p.8">In the subsections below we provide further details about the different building blocks.</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#oauth2Overview" id="oauth2Overview">OAuth 2.0</a></h1>
<p id="rfc.section.3.1.p.1">The OAuth 2.0 authorization framework enables a client to obtain limited access to a resource with the permission of a resource owner.  Authorization information, or references to it, is passed between the nodes using access tokens.  These access tokens are issued to clients by an authorization server with the approval of the resource owner.  The client uses the access token to access the protected resources hosted by the resource server.</p>
<p id="rfc.section.3.1.p.2">A number of OAuth 2.0 terms are used within this specification: </p>

<dl>
  <dt>The token and introspect Endpoints:</dt>
  <dd style="margin-left: 8"><br/><br/> The AS hosts the /token endpoint that allows a client to request access tokens. The client makes a POST request to the /token endpoint on the AS and receives the access token in the response (if the request was successful).  <br/><br/> The token introspection endpoint, /introspect, is used by the RS when requesting additional information regarding a received access token.  The RS makes a POST request to /introspect on the AS and receives information about the access token in the response. (See "Introspection" below.) <br/><br/> </dd>
  <dt>Access Tokens:</dt>
  <dd style="margin-left: 8"><br/><br/> Access tokens are credentials needed to access protected resources.  An access token is a data structure representing authorization permissions issued by the AS to the client.  Access tokens are generated by the authorization server and consumed by the resource server.  The access token content is opaque to the client.  <br/><br/> Access tokens can have different formats, and various methods of utilization (e.g., cryptographic properties) based on the security requirements of the given deployment.  <br/><br/> </dd>
  <dt>Proof of Possession Tokens:</dt>
  <dd style="margin-left: 8"><br/><br/> An access token may be bound to a cryptographic key, which is then used by an RS to authenticate requests from a client.  Such tokens are called proof-of-possession tokens (or PoP tokens).  <br/><br/> The proof-of-possession (PoP) security concept assumes that the AS acts as a trusted third party that binds keys to access tokens.  These so called PoP keys are then used by the client to demonstrate the possession of the secret to the RS when accessing the resource.  The RS, when receiving an access token, needs to verify that the key used by the client matches the one bound to the access token.  When this specification uses the term "access token" it is assumed to be a PoP token unless specifically stated otherwise.  <br/><br/> The key bound to the access token (aka PoP key) may be based on symmetric as well as on asymmetric cryptography.  The appropriate choice of security depends on the constraints of the IoT devices as well as on the security requirements of the use case.  <dl><dt>Symmetric PoP key:</dt><dd style="margin-left: 8">The AS generates a random symmetric PoP key.  The key is either stored to be returned on introspection calls or encrypted and included in the access token.  The PoP key is also encrypted for the client and sent together with the access token to the client.<br/> </dd><dt>Asymmetric PoP key:</dt><dd style="margin-left: 8">An asymmetric key pair is generated on the client and the public key is sent to the AS (if it does not already have knowledge of the client's public key).  Information about the public key, which is the PoP key in this case, is either stored to be returned on introspection calls or included inside the access token and sent back to the requesting client.  The RS can identify the client's public key from the information in the token, which allows the client to use the corresponding private key for the proof of possession.  </dd></dl><p> </p><br/><br/> The access token is either a simple reference, or a structured information object (e.g. CWT <a href="#I-D.ietf-ace-cbor-web-token">[I-D.ietf-ace-cbor-web-token]</a>), protected by a cryptographic wrapper (e.g. COSE <a href="#I-D.ietf-cose-msg">[I-D.ietf-cose-msg]</a>).  The choice of PoP key does not necessarily imply a specific credential type for the integrity protection of the token.<br/> </dd>
  <dt>Scopes and Permissions:</dt>
  <dd style="margin-left: 8"><br/><br/> In OAuth 2.0, the client specifies the type of permissions it is seeking to obtain (via the scope parameter) in the access token request.  In turn, the AS may use the scope response parameter to inform the client of the scope of the access token issued.  As the client could be a constrained device as well, this specification uses CBOR encoded messages for CoAP, defined in <a href="#oauthProfile">Section 5</a>, to request scopes and to be informed what scopes the access token was actually authorized for by the AS.  <br/><br/> The values of the scope parameter are expressed as a list of space- delimited, case-sensitive strings, with a semantic that is well-known to the AS and the RS.  More details about the concept of scopes is found under Section 3.3 in <a href="#RFC6749">[RFC6749]</a>.<br/> </dd>
  <dt>Claims:</dt>
  <dd style="margin-left: 8"><br/><br/> Information carried in the access token or returned from introspection, called claims, is in the form of type-value pairs.  An access token may, for example, include a claim identifying the AS that issued the token (via the "iss" claim) and what audience the access token is intended for (via the "aud" claim).  The audience of an access token can be a specific resource or one or many resource servers.  The resource owner policies influence what claims are put into the access token by the authorization server.  <br/><br/> While the structure and encoding of the access token varies throughout deployments, a standardized format has been defined with the JSON Web Token (JWT) <a href="#RFC7519">[RFC7519]</a> where claims are encoded as a JSON object.  In <a href="#I-D.ietf-ace-cbor-web-token">[I-D.ietf-ace-cbor-web-token]</a> an equivalent format using CBOR encoding (CWT) has been defined.  <br/> </dd>
  <dt>Introspection:</dt>
  <dd style="margin-left: 8"><br/><br/> Introspection is a method for a resource server to query the authorization server for the active state and content of a received access token.  This is particularly useful in those cases where the authorization decisions are very dynamic and/or where the received access token itself is a reference rather than a self-contained token.   More information about introspection in OAuth 2.0 can be found in <a href="#RFC7662">[RFC7662]</a>.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#coap" id="coap">CoAP</a></h1>
<p id="rfc.section.3.2.p.1">CoAP is an application layer protocol similar to HTTP, but specifically designed for constrained environments.  CoAP typically uses datagram-oriented transport, such as UDP, where reordering and loss of packets can occur.  A security solution need to take the latter aspects into account.</p>
<p id="rfc.section.3.2.p.2">While HTTP uses headers and query-strings to convey additional information about a request, CoAP encodes such information in so-called 'options'.</p>
<p id="rfc.section.3.2.p.3">CoAP supports application-layer fragmentation of the CoAP payloads through blockwise transfers <a href="#RFC7959">[RFC7959]</a>.  However, block-wise transfer does not increase the size limits of CoAP options, therefore data encoded in options has to be kept small.  </p>
<p id="rfc.section.3.2.p.4">Transport layer security for CoAP can be provided by DTLS 1.2 <a href="#RFC6347">[RFC6347]</a> or TLS 1.2 <a href="#RFC5246">[RFC5246]</a>.  CoAP defines a number of proxy operations which requires transport layer security to be terminated at the proxy. One approach for protecting CoAP communication end-to-end through proxies, and also to support security for CoAP over a different transport in a uniform way, is to provide security on application layer using an object-based security mechanism such as COSE <a href="#I-D.ietf-cose-msg">[I-D.ietf-cose-msg]</a>.  </p>
<p id="rfc.section.3.2.p.5">One application of COSE is OSCOAP <a href="#I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</a>, which provides end-to-end confidentiality, integrity and replay protection, and a secure binding between CoAP request and response messages. In OSCOAP, the CoAP messages are wrapped in COSE objects and sent using CoAP.  </p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#specs" id="specs">Protocol Interactions</a></h1>
<p id="rfc.section.4.p.1">The ACE framework is based on the OAuth 2.0 protocol interactions using the /token and /introspect endpoints.  A client obtains an access token from an AS using the /token endpoint and subsequently presents the access token to a RS to gain access to a protected resource.  The RS, after receiving an access token, may present it to the AS via the /introspect endpoint to get information about the access token. In other deployments the RS may process the access token locally without the need to contact an AS.  These interactions are shown in <a href="#fig:protocolFlow">Figure 1</a>.  An overview of various OAuth concepts is provided in <a href="#oauth2Overview">Section 3.1</a>.  </p>
<p id="rfc.section.4.p.2">The OAuth 2.0 framework defines a number of "protocol flows" via grant types, which have been extended further with extensions to OAuth 2.0 (such as RFC 7521 <a href="#RFC7521">[RFC7521]</a> and <a href="#I-D.ietf-oauth-device-flow">[I-D.ietf-oauth-device-flow]</a>).  What grant types works best depends on the usage scenario and RFC 7744 <a href="#RFC7744">[RFC7744]</a> describes many different IoT use cases but there are two preferred grant types, namely the Authorization Code Grant (described in Section 4.1 of RFC 7521) and the Client Credentials Grant (described in Section 4.4 of RFC 7521). The Authorization Code Grant is a good fit for use with apps running on smart phones and tablets that request access to IoT devices, a common scenario in the smart home environment, where users need to go through an authentication and authorization phase (at least during the initial setup phase). The native apps guidelines described in <a href="#I-D.ietf-oauth-native-apps">[I-D.ietf-oauth-native-apps]</a> are applicable to this use case. The Client Credential Grant is a good fit for use with IoT devices where the OAuth client itself is constrained. In such a case the resource owner or another person on his or her behalf have arranged with the authorization server out-of-band, which is often accomplished using a commissioning tool.</p>
<p id="rfc.section.4.p.3">The consent of the resource owner, for giving a client access to a protected resource, can be provided dynamically as in the traditional OAuth flows, or it could be pre-configured by the resource owner as authorization policies at the AS, which the AS evaluates when a token request arrives.  The resource owner and the requesting party (i.e. client owner) are not shown in <a href="#fig:protocolFlow">Figure 1</a>.  </p>
<p id="rfc.section.4.p.4">This framework supports a wide variety of communication security mechanisms between the ACE entities, such as client, AS, and RS. We assume that the client has been registered (also called enrolled or onboarded) to an AS using a mechanism defined outside the scope of this document.  In practice, various techniques for onboarding have been used, such as factory-based provisioning or the use of commissioning tools. Regardless of the onboarding technique, this registration procedure implies that the client and the AS share credentials, and configuration parameters.  These credentials are used to mutually authenticate each other and to protect messages exchanged between the client and the AS.</p>
<p id="rfc.section.4.p.5">It is also assumed that the RS has been registered with the AS, potentially in a similar way as the client has been registered with the AS.  Established keying material between the AS and the RS allows the AS to apply cryptographic protection to the access token to ensure that its content cannot be modified, and if needed, that the content is confidentiality protected.</p>
<p id="rfc.section.4.p.6">The keying material necessary for establishing communication security between C and RS is dynamically established as part of the protocol described in this document.  </p>
<p id="rfc.section.4.p.7">At the start of the protocol there is an optional discovery step where the client discovers the resource server and the resources this server hosts.  In this step the client might also determine what permissions are needed to access the protected resource.  The detailed procedures for this discovery process may be defined in an ACE profile and depend on the protocols being used and the specific deployment environment.</p>
<p id="rfc.section.4.p.8">In Bluetooth Low Energy, for example, advertisements are broadcasted by a peripheral, including information about the primary services.  In CoAP, as a second example, a client can make a request to "/.well-known/core" to obtain information about available resources, which are returned in a standardized format as described in <a href="#RFC6690">[RFC6690]</a>.  </p>
<div id="rfc.figure.1"/>
<div id="fig:protocolFlow"/>
<pre>
+--------+                               +---------------+
|        |---(A)-- Token Request -------&gt;|               |
|        |                               | Authorization |
|        |&lt;--(B)-- Access Token ---------|    Server     |
|        |       + RS Information        |               |
|        |                               +---------------+
|        |                                      ^ |
|        |            Introspection Request  (D)| |
| Client |                                      | |
|        |             Response + Client Token  | |(E)
|        |                                      | v
|        |                               +--------------+
|        |---(C)-- Token + Request -----&gt;|              |
|        |                               |   Resource   |
|        |&lt;--(F)-- Protected Resource ---|    Server    |
|        |                               |              |
+--------+                               +--------------+
  </pre>
<p class="figure">Figure 1: Basic Protocol Flow.</p>
<p/>
<p/>

<dl>
  <dt>Requesting an Access Token (A):</dt>
  <dd style="margin-left: 8"><br/><br/> The client makes an access token request to the /token endpoint at the AS.  This framework assumes the use of PoP tokens (see <a href="#oauth2Overview">Section 3.1</a> for a short description) wherein the AS binds a key to an access token.  The client may include permissions it seeks to obtain, and information about the credentials it wants to use (e.g., symmetric/asymmetric cryptography or a reference to a specific credential).<br/> </dd>
  <dt>Access Token Response (B):</dt>
  <dd style="margin-left: 8"><br/><br/> If the AS successfully processes the request from the client, it returns an access token.  It also returns various parameters, referred as "RS Information".  In addition to the response parameters defined by OAuth 2.0 and the PoP token extension, further response parameters, such as information on which profile the client should use with the resource server(s). More information about these parameters can be found in <a href="#tokenParams">Section 6.4</a>.  <br/> </dd>
  <dt>Resource Request (C):</dt>
  <dd style="margin-left: 8"><br/><br/> The client interacts with the RS to request access to the protected resource and provides the access token.  The protocol to use between the client and the RS is not restricted to CoAP. HTTP, HTTP/2, QUIC, MQTT, Bluetooth Low Energy, etc., are also viable candidates.  <br/><br/> Depending on the device limitations and the selected protocol this exchange may be split up into two parts: <ul class="empty"><li>(1) the client sends the access token containing, or referencing, the authorization information to the RS, that may be used for subsequent resource requests by the client, and </li><li>(2) the client makes the resource access request, using the communication security protocol and other RS Information obtained from the AS.</li></ul><p> </p><br/><br/> The Client and the RS mutually authenticate using the security protocol specified in the profile (see step B) and the keys obtained in the access token or the RS Information or the client token.  The RS verifies that the token is integrity protected by the AS and compares the claims contained in the access token with the resource request. If the RS is online, validation can be handed over to the AS using token introspection (see messages D and E) over HTTP or CoAP, in  which case the different parts of step C may be interleaved with introspection.<br/> </dd>
  <dt>Token Introspection Request (D):</dt>
  <dd style="margin-left: 8"><br/><br/> A resource server may be configured to introspect the access token by including it in a request to the /introspect endpoint at that AS.  Token introspection over CoAP is defined in <a href="#introspectionEndpoint">Section 7</a> and for HTTP in <a href="#RFC7662">[RFC7662]</a>.  <br/><br/> Note that token introspection is an optional step and can be omitted if the token is self-contained and the resource server is prepared to perform the token validation on its own.<br/> </dd>
  <dt>Token Introspection Response (E):</dt>
  <dd style="margin-left: 8"><br/><br/> The AS validates the token and returns the most recent parameters, such as scope, audience, validity etc. associated with it back to the RS.  The RS then uses the received parameters to process the request to either accept or to deny it. The AS can additionally return information that the RS needs to pass on to the client in the form of a client token.  The latter is used to establish keys for mutual authentication between client and RS, when the client has no direct connectivity to the AS, see <a href="#clientToken">Section 7.4</a> for details.<br/> </dd>
  <dt>Protected Resource (F):</dt>
  <dd style="margin-left: 8"><br/><br/> If the request from the client is authorized, the RS fulfills the request and returns a response with the appropriate response code.  The RS uses the dynamically established keys to protect the response, according to used communication security protocol.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#oauthProfile" id="oauthProfile">Framework</a></h1>
<p id="rfc.section.5.p.1">The following sections detail the profiling and extensions of OAuth 2.0 for constrained environments which constitutes the ACE framework.  </p>
<p/>

<dl>
  <dt>Credential Provisioning</dt>
  <dd style="margin-left: 8"><br/><br/> For IoT we cannot generally assume that the client and RS are part of a common key infrastructure, so the AS provisions credentials or associated information to allow mutual authentication. These credentials need to be provided to the parties before or during the authentication protocol is executed, and may be re-used for subsequent token requests.  <br/> </dd>
  <dt>Proof-of-Possession</dt>
  <dd style="margin-left: 8"><br/><br/> The ACE framework by default implements proof-of-possession for access tokens, i.e. that the token holder can prove being a holder of the key bound to the token.  The binding is provided by the "cnf" claim indicating what key is used for mutual authentication. If clients need to update a token, e.g. to get additional rights, they can request that the AS binds the new access token to the same credential as the previous token.  <br/> </dd>
  <dt>ACE Profiles</dt>
  <dd style="margin-left: 8"><br/><br/> The client or RS may be limited in the encodings or protocols it supports.  To support a variety of different deployment settings, specific interactions between client and RS are defined in an ACE profile.  In ACE framework the AS is expected to manage the matching of compatible profile choices between a client and an RS.  The AS informs the client of the selected profile using the "profile" parameter in the token request and token response.  <br/> </dd>
</dl>

<p> </p>
<p id="rfc.section.5.p.3">OAuth 2.0 requires the use of TLS both to protect the communication between AS and client when requesting an access token; between client and RS when accessing a resource and between AS and RS for introspection.  In constrained settings TLS is not always feasible, or desirable.  Nevertheless it is REQUIRED that the data exchanged with the AS is encrypted and integrity protected.  It is furthermore REQUIRED that the AS and the endpoint communicating with it (client or RS) perform mutual authentication.</p>
<p id="rfc.section.5.p.4">Profiles are expected to specify the details of how this is done, depending e.g. on the communication protocol and the credentials used by the client or the RS.  </p>
<p id="rfc.section.5.p.5">In OAuth 2.0 the communication with the Token and the Introspection endpoints at the AS is assumed to be via HTTP and may use Uri-query parameters.  This framework RECOMMENDS to use CoAP instead and RECOMMENDS the use of the following alternative instead of Uri-query parameters: The sender (client or RS) encodes the parameters of its request as a CBOR map and submits that map as the payload  of the POST request.  The Content-format depends on the security applied to the content and must be specified by the corresponding profile.  </p>
<p id="rfc.section.5.p.6">The OAuth 2.0 AS uses a JSON structure in the payload of its responses both to client and RS.  This framework RECOMMENDS the use of CBOR <a href="#RFC7049">[RFC7049]</a> instead.  The requesting device can explicitly request this encoding by setting the CoAP Accept option in the request to "application/cbor".  Depending on the profile, the content may arrive in a different format wrapping a CBOR payload.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#tokenEndpoint" id="tokenEndpoint">The 'Token' Endpoint</a></h1>
<p id="rfc.section.6.p.1">In plain OAuth 2.0 the AS provides the /token endpoint for submitting access token requests.  This framework extends the functionality of the /token endpoint, giving the AS the possibility to help client and RS to establish shared keys or to exchange their public keys.  Furthermore this framework defines encodings using CoAP and CBOR, instead of HTTP and JSON.</p>
<p id="rfc.section.6.p.2">Communication between the client and the /token endpoint at the AS MUST be integrity protected and encrypted.  Furthermore AS and client MUST perform mutual authentication.  Profiles of this framework are expected to specify how authentication and communication security is implemented.  </p>
<p id="rfc.section.6.p.3">The figures of this section uses CBOR diagnostic notation without the integer abbreviations for the parameters or their values for better readability.  </p>
<h1 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> <a href="#tokenRequest" id="tokenRequest">Client-to-AS Request</a></h1>
<p id="rfc.section.6.1.p.1">The client sends a CoAP POST request to the token endpoint at the AS, the profile is expected to specify the Content-Type and wrapping of the payload.  The content of the request consists of the parameters specified in section 4 of the OAuth 2.0 specification <a href="#RFC6749">[RFC6749]</a> encoded as a CBOR map.</p>
<p id="rfc.section.6.1.p.2">In addition to these parameters, this framework defines the following parameters for requesting an access token from a /token endpoint: </p>

<dl>
  <dt>aud</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL.  Specifies the audience for which the client is requesting an access token.  If this parameter is missing it is assumed that the client and the AS have a pre-established understanding of the audience that an access token should address.  If a client submits a request for an access token without specifying an "aud" parameter, and the AS does not have a default "aud" value for this client, then the AS MUST respond with an error message with the CoAP response code 4.00 (Bad Request).  <br/><br/></dd>
  <dt>cnf</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL.  This field contains information about the key the client would like to bind to the access token for proof-of-possession.  It is NOT RECOMMENDED that a client submits a symmetric key value to the AS using this parameter.  See <a href="#paramCnf">Section 6.4.5</a> for more details on the formatting of the 'cnf' parameter.</dd>
</dl>

<p> </p>
<p id="rfc.section.6.1.p.3">The following examples illustrate different types of requests for proof-of-possession tokens. </p>
<div id="rfc.figure.2"/>
<div id="fig:symmATreq"/>
<pre>
Header: POST (Code=0.02)
Uri-Host: "server.example.com"
Uri-Path: "token"
Content-Type: "application/cbor"
Payload:
{
  "grant_type" : "client_credentials",
  "aud" : "tempSensor4711",
 }
        </pre>
<p class="figure">Figure 2: Example request for an access token bound to a      symmetric key.</p>
<p><a href="#fig:symmATreq">Figure 2</a> shows a request for a token with a symmetric proof-of-possession key.  Note that in this example we assume a DTLS-based communication security profile, therefore the Content-Type is "application/cbor".  </p>
<div id="rfc.figure.3"/>
<div id="fig:asymmATreq"/>
<pre>
Header: POST (Code=0.02)
Uri-Host: "server.example.com"
Uri-Path: "token"
Content-Type: "application/cose+cbor"
Payload:
{
  "grant_type" : "client_credentials",
  "cnf" : {
    "COSE_Key" : {
      "kty" : "EC",
      "kid" : h'11',
      "crv" : "P-256",
      "x" : b64'usWxHK2PmfnHKwXPS54m0kTcGJ90UiglWiGahtagnv8',
      "y" : b64'IBOL+C3BttVivg+lSreASjpkttcsz+1rb7btKLv8EX4'
    }
  }
}
        </pre>
<p class="figure">Figure 3: Example request for an access token bound to an      asymmetric key.</p>
<p><a href="#fig:asymmATreq">Figure 3</a> shows a request for a token with an asymmetric proof-of-possession key.  Note that in this example we assume an object security-based profile, therefore the Content-Type is "application/cose+cbor".  </p>
<div id="rfc.figure.4"/>
<div id="fig:kidATreq"/>
<pre>
Header: POST (Code=0.02)
Uri-Host: "server.example.com"
Uri-Path: "token"
Content-Type: "application/cbor"
Payload:
{
  "grant_type" : "client_credentials",
  "client_id" : "myclient",
  "client_secret" : "mysecret234",
  "aud" : "valve424",
  "scope" : "read",
  "cnf" : {
    "kid" : b64'6kg0dXJM13U'
  }
}
       </pre>
<p class="figure">Figure 4: Example request for an access token bound to a      key reference.</p>
<p><a href="#fig:kidATreq">Figure 4</a> shows a request for a token where a previously communicated proof-of-possession key is only referenced.  Note that we assume a DTLS-based communication security profile for this example, therefore the Content-Type is "application/cbor".  Also note that the client performs a password based authentication in this example by submitting its client_secret (see section 2.3.1. of <a href="#RFC6749">[RFC6749]</a>).  </p>
<h1 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> <a href="#tokenResponse" id="tokenResponse">AS-to-Client Response</a></h1>
<p id="rfc.section.6.2.p.1">If the access token request has been successfully verified by the AS and the client is authorized to obtain an access token corresponding to its access token request, the AS sends a response with the CoAP response code 2.01 (Created).  If client request was invalid, or not authorized, the AS returns an error response as described in <a href="#errorsToken">Section 6.3</a>.</p>
<p id="rfc.section.6.2.p.2">Note that the AS decides which token type and profile to use when issuing a successful response.  It is assumed that the AS has prior knowledge of the capabilities of the client, and the RS.  This prior knowledge may, for example, be set by the use of a dynamic client registration protocol exchange <a href="#RFC7591">[RFC7591]</a>.</p>
<p id="rfc.section.6.2.p.3">The content of the successful reply MUST be encoded as CBOR map, containing parameters as speficied in section 5.1 of <a href="#RFC6749">[RFC6749]</a>.  In addition to these parameters, the following parameters are also part of a successful response: </p>

<dl>
  <dt>profile</dt>
  <dd style="margin-left: 8"><br/> REQUIRED.  This indicates the profile that the client MUST use towards the RS. See <a href="#paramProfile">Section 6.4.4</a> for the formatting of this parameter.<br/><br/></dd>
  <dt>cnf</dt>
  <dd style="margin-left: 8"><br/> REQUIRED if the token type is 'pop'. OPTIONAL otherwise.  If a symmetric proof-of-possession algorithms was selected, this field contains the proof-of-possession key.  If an asymmetric algorithm was selected, this field contains information about the public key used by the RS to authenticate.  See <a href="#paramCnf">Section 6.4.5</a> for the formatting of this parameter.</dd>
  <dt>token_type</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL.  By default implementations of this framework SHOULD assume that the token_type is 'pop'.  If a specific use case requires another token_type (e.g. 'Bearer') to be used then this parameter is REQUIRED.  </dd>
</dl>

<p> </p>
<p id="rfc.section.6.2.p.4">Note that if CBOR Web Tokens <a href="#I-D.ietf-ace-cbor-web-token">[I-D.ietf-ace-cbor-web-token]</a> are used, the access token can also contain a 'cnf' claim.  This claim is however consumed by a different party.  The access token is created by the AS and processed by the RS (and opaque to the client) whereas the RS Information is created by the AS and processed by the client; it is never forwarded to the resource server.</p>
<p id="rfc.section.6.2.p.5">The following examples illustrate different types of responses for proof-of-possession tokens.  </p>
<div id="rfc.figure.5"/>
<div id="fig:symmATres"/>
<pre>
Header: Created (Code=2.01)
Content-Type: "application/cbor"
Payload:
{
  "access_token" : b64'SlAV32hkKG ...
   (remainder of CWT omitted for brevity;
   CWT contains COSE_Key in the 'cnf' claim)',
  "profile" : "coap_dtls",
  "expires_in" : "3600",
  "cnf" : {
    "COSE_Key" : {
      "kty" : "Symmetric",
      "kid" : b64'39Gqlw',
      "k" : b64'hJtXhkV8FJG+Onbc6mxCcQh'
    }
  }
}
      </pre>
<p class="figure">Figure 5: Example AS response with an access token bound to a      symmetric key.</p>
<p><a href="#fig:symmATres">Figure 5</a> shows a response containing a token and a 'cnf' parameter with a symmetric proof-of-possession key.  Note that we assume a DTLS-based communication security profile for this example, therefore the Content-Type is "application/cbor".  </p>
<h1 id="rfc.section.6.3"><a href="#rfc.section.6.3">6.3.</a> <a href="#errorsToken" id="errorsToken">Error Response</a></h1>
<p id="rfc.section.6.3.p.1">The error responses for CoAP-based interactions with the AS are equivalent to the ones for HTTP-based interactions as defined in section  5.2 of <a href="#RFC6749">[RFC6749]</a>, with the following differences: The Content-Type is specified by the communication security profile used between client and AS.  The raw payload before being processed by the communication security protocol MUST be encoded as a CBOR map and the CoAP response code 4.00 (Bad Request) MUST be used unless specified otherwise.  </p>
<h1 id="rfc.section.6.4"><a href="#rfc.section.6.4">6.4.</a> <a href="#tokenParams" id="tokenParams">New Request and Response Parameters</a></h1>
<p id="rfc.section.6.4.p.1">This section provides more detail about the new parameters that can be used in access token requests and responses, as well as abbreviations for more compact encoding of existing parameters and common parameter values.</p>
<h1 id="rfc.section.6.4.1"><a href="#rfc.section.6.4.1">6.4.1.</a> <a href="#paramAud" id="paramAud">Audience</a></h1>
<p id="rfc.section.6.4.1.p.1">This parameter specifies for which audience the client is requesting a token.  It should be encoded as CBOR text string (major type 3).  The formatting and semantics of these strings are application specific.</p>
<h1 id="rfc.section.6.4.2"><a href="#rfc.section.6.4.2">6.4.2.</a> <a href="#paramGrantType" id="paramGrantType">Grant Type</a></h1>
<div id="rfc.figure.6"/>
<div id="fig:grant_types"/>
<pre>
          /--------------------+----------+--------------\
          | grant_type         | CBOR Key | Major Type   |
          |--------------------+----------+--------------|
          | password           |    0     |     0 (uint) |
          | authorization_code |    1     |     0        |
          | client_credentials |    2     |     0        |
          | refresh_token      |    3     |     0        |
          \--------------------+----------+--------------/
        </pre>
<p class="figure">Figure 6: CBOR abbreviations for common grant types </p>
<p id="rfc.section.6.4.2.p.1">The abbreviations in <a href="#fig:grant_types">Figure 6</a> MAY be used in CBOR encodings instead of the string values defined in <a href="#RFC6749">[RFC6749]</a>.  </p>
<h1 id="rfc.section.6.4.3"><a href="#rfc.section.6.4.3">6.4.3.</a> <a href="#paramTokenType" id="paramTokenType">Token Type</a></h1>
<p id="rfc.section.6.4.3.p.1">The 'token_type' parameter allows the AS to indicate to the client which type of access token it is receiving (e.g. a bearer token).  The 'pop' token type MUST be assumed by default if the AS does not provide a different value.</p>
<p id="rfc.section.6.4.3.p.2">This document registers the new value "pop" for the OAuth Access Token Types registry,  specifying a Proof-of-Possession token.  How the proof-of-possession is performed is specified by the profiles.</p>
<p id="rfc.section.6.4.3.p.3">The values in the 'token_type' parameter are CBOR text strings (major type 3).</p>
<h1 id="rfc.section.6.4.4"><a href="#rfc.section.6.4.4">6.4.4.</a> <a href="#paramProfile" id="paramProfile">Profile</a></h1>
<p id="rfc.section.6.4.4.p.1">Profiles of this framework are expected to define the communication protocol and the communication security protocol between the client and the RS.  Furthermore profiles are expected to define proof-of-possession methods, if they support proof-of-possession tokens.</p>
<p id="rfc.section.6.4.4.p.2">A profile should specify an identifier that is used to uniquely identify itself in the 'profile' parameter.</p>
<p id="rfc.section.6.4.4.p.3">Profiles MAY define additional parameters for both the token request and the RS Information in the access token response in order to support negotioation or signalling of profile specific parameters.  </p>
<h1 id="rfc.section.6.4.5"><a href="#rfc.section.6.4.5">6.4.5.</a> <a href="#paramCnf" id="paramCnf">Confirmation</a></h1>
<p id="rfc.section.6.4.5.p.1">The "cnf" parameter identifies or provides the key used for proof-of-possession or for authenticating the RS depending on the proof-of-possession algorithm and the context cnf is used in.  This framework extends  the definition of 'cnf' from <a href="#RFC7800">[RFC7800]</a> by adding CBOR/COSE encodings and the use of 'cnf' for transporting keys in the RS Information.</p>
<p id="rfc.section.6.4.5.p.2">The "cnf" parameter is used in the following contexts with the following meaning: </p>

<ul>
  <li>In the access token, to indicate the proof-of-possession key bound to this token.</li>
  <li>In the token request C -&gt; AS, to indicate the client's raw public key, or the key-identifier of a previously established key between C and RS.</li>
  <li>In the token response AS -&gt; C, to indicate either the symmetric key generated by the AS for proof-of-possession or the raw public key used by the RS to authenticate.</li>
  <li>In the introspection response AS -&gt; RS, to indicate the proof-of-possession	key bound to the introspected token.</li>
  <li>In the client token AS -&gt; RS -&gt; C, to indicate the proof-of-possession	key bound to the access token.</li>
</ul>
<div id="rfc.figure.7"/>
<div id="fig:cnfKey"/>
<pre>
"cnf" : {
  "COSE_Key" : {
    "kty" : "EC",
    "kid" : h'11',
    "crv" : "P-256",
    "x" : b64'usWxHK2PmfnHKwXPS54m0kTcGJ90UiglWiGahtagnv8',
    "y" : b64'IBOL+C3BttVivg+lSreASjpkttcsz+1rb7btKLv8EX4'
  }
}
        </pre>
<p class="figure">Figure 7: Confirmation parameter containing a public key</p>
<div id="rfc.figure.8"/>
<div id="fig:cnfEnc"/>
<pre>
"cnf" : {
  "COSE_Encrypted" : {
    993(
      [ h'a1010a' # protected header : {"alg" : "AES-CCM-16-64-128"}
        "iv" : b64'ifUvZaHFgJM7UmGnjA',  # unprotected header
       b64'WXThuZo6TMCaZZqi6ef/8WHTjOdGk8kNzaIhIQ' # ciphertext
      ]
    )
  }
}
        </pre>
<p class="figure">Figure 8: Confirmation paramter containing an encrypted         symmetric key</p>
<div id="rfc.figure.9"/>
<div id="fig:cnfEKey"/>
<pre>
{
  "kty" : "Symmetric",
  "kid" : b64'39Gqlw',
  "k" : b64'hJtXhkV8FJG+Onbc6mxCcQh'
}
        </pre>
<p class="figure">Figure 9: Example plaintext of an encrypted cnf parameter</p>
<div id="rfc.figure.10"/>
<div id="fig:cnfKid"/>
<pre>
"cnf" : {
  "kid" : b64'39Gqlw'
}
        </pre>
<p class="figure">Figure 10: A Confirmation parameter with just a key identifier</p>
<p id="rfc.section.6.4.5.p.3">A CBOR encoded payload MAY contain the 'cnf' parameter with the following contents: </p>

<dl>
  <dt>COSE_Key</dt>
  <dd style="margin-left: 8">In this case the 'cnf' parameter contains the proof-of-possession key to be used by the client.  An example is shown in <a href="#fig:cnfKey">Figure 7</a>.  <br/><br/> Note that the COSE_Key structure may contain an "alg" or "key_ops" parameter.  If such parameters are present, a client MUST NOT use a key that is not compatible with the profile or proof-of-possession algorithm according to those parameters.  </dd>
  <dt>COSE_Encrypted</dt>
  <dd style="margin-left: 8">In this case the 'cnf' parameter contains an encrypted symmetric key destined for the client.  The client is assumed to be able to decrypt the cihpertext of this parameter.  The parameter is encoded as COSE_Encrypted object wrapping a COSE_Key object.  <a href="#fig:cnfEnc">Figure 8</a> shows an example of this type of encoding.  <a href="#fig:cnfEKey">Figure 9</a>.  <br/><br/> </dd>
  <dt>Key Identifier</dt>
  <dd style="margin-left: 8">In this case the 'cnf' parameter references a key that is assumed to be previously known by the recipient.  This allows clients that perform repeated requests for an access token for the same audience but e.g. with different scopes to omit key transport in the access token, token request and token response. <a href="#fig:cnfKid">Figure 10</a> shows such an example.  </dd>
</dl>
<h1 id="rfc.section.6.5"><a href="#rfc.section.6.5">6.5.</a> <a href="#tokenCborParams" id="tokenCborParams">Mapping parameters to CBOR</a></h1>
<p id="rfc.section.6.5.p.1">All OAuth parameters in access token requests and responses are mapped to CBOR types as follows and are given an integer key value to save space.</p>
<div id="rfc.figure.11"/>
<div id="fig:cborTokenParameters"/>
<pre>
        /-------------------+----------+-----------------\
        | Parameter name    | CBOR Key | Major Type      |
        |-------------------+----------+-----------------|
        | aud               | 3        | 3               |
        | client_id         | 8        | 3 (text string) |
        | client_secret     | 9        | 2 (byte string) |
        | response_type     | 10       | 3               |
        | redirect_uri      | 11       | 3               |
        | scope             | 12       | 3               |
        | state             | 13       | 3               |
        | code              | 14       | 2               |
        | error_description | 15       | 3               |
        | error_uri         | 16       | 3               |
        | grant_type        | 17       | 0 (unit)        |
        | access_token      | 18       | 3               |
        | token_type        | 19       | 0               |
        | expires_in        | 20       | 0               |
        | username          | 21       | 3               |
        | password          | 22       | 3               |
        | refresh_token     | 23       | 3               |
        | cnf               | 24       | 5 (map)         |
        | profile           | 25       | 3               |
        \-------------------+----------+-----------------/
      </pre>
<p class="figure">Figure 11: CBOR mappings used in token requests</p>
<p/>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#introspectionEndpoint" id="introspectionEndpoint">The 'Introspect' Endpoint</a></h1>
<p id="rfc.section.7.p.1">Token introspection <a href="#RFC7662">[RFC7662]</a> is used by the RS and potentially the client to query the AS for metadata about a given token e.g. validity or scope. Analogous to the protocol defined in RFC 7662 <a href="#RFC7662">[RFC7662]</a> for HTTP and JSON, this section defines adaptations to more constrained  environments using CoAP and CBOR.</p>
<p id="rfc.section.7.p.2">Communication between the RS and the introspection endpoint at the AS MUST be integrity protected and encrypted.  Furthermore AS and RS MUST perform mutual authentication.  Finally the AS SHOULD verify that the RS has the right to access introspection information about the provided token.  Profiles of this framework are expected to specify how authentication and communication security is implemented.</p>
<p id="rfc.section.7.p.3">The figures of this section uses CBOR diagnostic notation without the integer abbreviations for the parameters or their values for better readability.  </p>
<h1 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1.</a> <a href="#introRS2AS" id="introRS2AS">RS-to-AS Request</a></h1>
<p id="rfc.section.7.1.p.1">The RS sends a CoAP POST request to the introspection endpoint at the AS, the profile is expected to specify the Content-Type and wrapping of the payload.  The payload MUST be encoded as a CBOR map with a 'token' parameter containing the access token along with optional parameters representing additional context that is known by the RS to aid the AS in its response.</p>
<p id="rfc.section.7.1.p.2">The same parameters are required and optional as in section 2.1 of RFC 7662 <a href="#RFC7662">[RFC7662]</a>.</p>
<div id="rfc.figure.12"/>
<div id="fig:introReq"/>
<pre>
Header: POST (Code=0.02)
Uri-Host: "server.example.com"
Uri-Path: "introspect"
Content-Type: "application/cose+cbor"
Payload:
{
  "token" : b64'7gj0dXJQ43U',
  "token_type_hint" : "pop"
}
       </pre>
<p class="figure">Figure 12: Example introspection request.</p>
<p id="rfc.section.7.1.p.3">For example, <a href="#fig:introReq">Figure 12</a> shows a RS calling the token introspection endpoint at the AS to query about an OAuth 2.0 proof-of-possession token.  Note that we assume a object security-based communication security profile for this example, therefore the Content-Type is "application/cose+cbor".  </p>
<h1 id="rfc.section.7.2"><a href="#rfc.section.7.2">7.2.</a> <a href="#introAS2RS" id="introAS2RS">AS-to-RS Response</a></h1>
<p id="rfc.section.7.2.p.1">If the introspection request is authorized and successfully processed, the AS sends a response with the CoAP response code 2.01 (Created).  If the introspection request was invalid, not authorized or couldn't be processed the AS returns an error response as described in <a href="#errorsIntro">Section 7.3</a>.</p>
<p id="rfc.section.7.2.p.2">In a successful response, the AS encodes the response parameters in a CBOR map including with the same required and optional parameters as in section 2.2. of RFC 7662 <a href="#RFC7662">[RFC7662]</a> with the following additions: </p>

<dl>
  <dt>cnf</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL.   This field contains information about the proof-of-possession key that binds the client to the access token.  See <a href="#paramCnf">Section 6.4.5</a> for more details on the formatting of the 'cnf' parameter.<br/><br/></dd>
  <dt>profile</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL.  This indicates the profile that the RS MUST use with the client.  See <a href="#paramProfile">Section 6.4.4</a> for more details on the formatting of this parameter.  <br/><br/></dd>
  <dt>client_token</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL.  This parameter contains information that the RS MUST pass on to the client.  See <a href="#clientToken">Section 7.4</a> for more details.</dd>
</dl>

<p> </p>
<div id="rfc.figure.13"/>
<div id="fig:introRes"/>
<pre>
Header: Created Code=2.01)
Content-Type: "application/cbor"
Payload:
{
  "active" : true,
  "scope" : "read",
  "profile" : "coap_dtls",
  "client_token" : b64'2QPhg0OhAQo ...
  (remainder of client token omitted for brevity)',
  "cnf" : {
    "COSE_Key" : {
      "kty" : "Symmetric",
      "kid" : b64'39Gqlw',
      "k" : b64'hJtXhkV8FJG+Onbc6mxCcQh'
    }
  }
}
      </pre>
<p class="figure">Figure 13: Example introspection response.</p>
<p id="rfc.section.7.2.p.3">For example, <a href="#fig:introRes">Figure 13</a> shows an AS response to the introspection request in <a href="#fig:introReq">Figure 12</a>.  Note that we assume a DTLS-based communication security profile for this example, therefore the Content-Type is "application/cbor".  </p>
<h1 id="rfc.section.7.3"><a href="#rfc.section.7.3">7.3.</a> <a href="#errorsIntro" id="errorsIntro">Error Response</a></h1>
<p id="rfc.section.7.3.p.1">The error responses for CoAP-based interactions with the AS are equivalent to the ones for HTTP-based interactions as defined in section 2.3 of <a href="#RFC7662">[RFC7662]</a>, with the following differences: </p>

<ul>
  <li>If content is sent, the Content-Type MUST be set according to the specification of the communication security profile, and the content payload MUST be encoded as a CBOR map.</li>
  <li>If the credentials used by the RS are invalid the AS MUST respond with the CoAP response code 4.01 (Unauthorized) and use the required and optional parameters from section 5.2 in RFC 6749 <a href="#RFC6749">[RFC6749]</a>.</li>
  <li>If the RS does not have the right to perform this introspection request, the AS MUST respond with the CoAP response code 4.03 (Forbidden).  In this case no payload is returned.</li>
</ul>

<p> </p>
<p id="rfc.section.7.3.p.2">Note that a properly formed and authorized query for an inactive or otherwise invalid token does not warrant an error response by this specification.  In these cases, the authorization server MUST instead respond with an introspection response with the "active" field set to "false".</p>
<h1 id="rfc.section.7.4"><a href="#rfc.section.7.4">7.4.</a> <a href="#clientToken" id="clientToken">Client Token</a></h1>
<p id="rfc.section.7.4.p.1">EDITORIAL NOTE: We have tentatively introduced this concept and would specifically like feedback whether this is viewed as a useful addition to the framework.</p>
<p id="rfc.section.7.4.p.2">In cases where the client has limited connectivity and needs to get access to a previously unknown resource servers, this framework suggests the following approach:  The client is pre-configured with a generic, long-term access token when it is commissioned.  When the client then tries to access a RS it transmits this access token.  The RS then performs token introspection to learn what access this token grants.  In the introspection response, the AS also relays information for the client, such as the proof-of-possession key, through the RS.  The RS passes on this Client Token to the client in response to the submission of the token.</p>
<div id="rfc.figure.14"/>
<div id="fig:client_token"/>
<pre>
                  Resource       Authorization
 Client            Server           Server
    |                |                |
    |                |                |
C:  +---------------&gt;|                |
    |  POST          |                |
    |  Access Token  |                |
    |            D:  +---------------&gt;|
    |                | Introspection  |
    |                |    Request     |
    |                |                |
    |            E:  +&lt;---------------+
    |                | Introspection  |
    |                |   Response     |
    |                | + Client Token |
    |&lt;---------------+                |
    |  2.01 Created  |                |
    | + Client Token |
    </pre>
<p class="figure">Figure 14: Use of the client_token parameter.</p>
<p id="rfc.section.7.4.p.3">The client_token parameter is designed to carry such information, and is intended to be used as described in <a href="#fig:client_token">Figure 14</a>.  </p>
<p id="rfc.section.7.4.p.4">The client token is a COSE_Encrypted object, containing as payload a CBOR map with the following claims: </p>

<dl>
  <dt>cnf</dt>
  <dd style="margin-left: 8"><br/> REQUIRED if the token type is 'pop', OPTIONAL otherwise.  Contains information about the proof-of-possession key the client is to use with its access token.  See <a href="#paramCnf">Section 6.4.5</a>.<br/><br/></dd>
  <dt>token_type</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL. See <a href="#paramTokenType">Section 6.4.3</a>.<br/><br/></dd>
  <dt>profile</dt>
  <dd style="margin-left: 8"><br/> REQUIRED. See <a href="#paramProfile">Section 6.4.4</a>.<br/><br/></dd>
  <dt>rs_cnf</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL. Contains information about the key that the RS uses to authenticate towards the client.  If the key is symmetric then this claim MUST NOT be part of the Client Token, since this is the same key as the one specified through the 'cnf' claim.  This claim uses the same encoding as the 'cnf' parameter.  See <a href="#paramProfile">Section 6.4.4</a>.</dd>
</dl>

<p> </p>
<p id="rfc.section.7.4.p.5">The AS encrypts this token using a key shared between the AS and the client, so that only the client can decrypt it and access its payload.  How this key is established is out of scope of this framework.</p>
<h1 id="rfc.section.7.5"><a href="#rfc.section.7.5">7.5.</a> <a href="#introParamsCbor" id="introParamsCbor">Mapping Introspection parameters to CBOR</a></h1>
<div id="rfc.figure.15"/>
<div id="fig:cborIntrospectionParameters"/>
<pre>
          /-----------------+----------+-----------------\
          | Parameter name  | CBOR Key | Major Type      |
          |-----------------+----------+-----------------|
          | iss             | 1        | 3 (text string) |
          | sub             | 2        | 3               |
          | aud             | 3        | 3               |
          | exp             | 4        | 6 tag value 1   |
          | nbf             | 5        | 6 tag value 1   |
          | iat             | 6        | 6 tag value 1   |
          | cti             | 7        | 2 (byte string) |
          | client_id       | 8        | 3               |
          | scope           | 12       | 3               |
          | token_type      | 19       | 3               |
          | username        | 21       | 3               |
          | cnf             | 24       | 5 (map)         |
          | profile         | 25       | 0 (uint)        |
          | token           | 26       | 3               |
          | token_type_hint | 27       | 3               |
          | active          | 28       | 0               |
          | client_token    | 29       | 3               |
          | rs_cnf          | 30       | 5               |
          \-----------------+----------+-----------------/
        </pre>
<p class="figure">Figure 15: CBOR Mappings to Token Introspection Parameters.</p>
<p id="rfc.section.7.5.p.1">The introspection request and response parameters are mapped to CBOR types as follows and are given an integer key value to save space.  </p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> The Access Token</h1>
<p id="rfc.section.8.p.1">This framework RECOMMENDS the use of CBOR web token (CWT) as specified in <a href="#I-D.ietf-ace-cbor-web-token">[I-D.ietf-ace-cbor-web-token]</a>.  </p>
<p id="rfc.section.8.p.2">In order to facilitate offline processing of access tokens, this draft specifies the "cnf" and "scope" claims for CBOR web tokens.</p>
<p id="rfc.section.8.p.3">The "scope" claim explicitly encodes the scope of a given access token.  This claim follows the same encoding rules as defined in section 3.3 of <a href="#RFC6749">[RFC6749]</a>.  The meaning of a specific scope value is application specific and expected to be known to the RS running that application.</p>
<p id="rfc.section.8.p.4">The "cnf" claim follows the same rules as specified for JSON web token in RFC7800 <a href="#RFC7800">[RFC7800]</a>, except that it is encoded in CBOR in the same way as specified for the "cnf" parameter in <a href="#paramCnf">Section 6.4.5</a>.</p>
<h1 id="rfc.section.8.1"><a href="#rfc.section.8.1">8.1.</a> The 'Authorization Information' Endpoint</h1>
<p id="rfc.section.8.1.p.1">The access token, containing authorization information and information of the key used by the client, needs to be transported to the RS so that the RS can authenticate and authorize the client request.</p>
<p id="rfc.section.8.1.p.2">This section defines a method for transporting the access token to the RS using CoAP. Profiles of this framework MAY define other methods for token transport.  Implementations conforming to this framework MUST implement this method of token transportation.  </p>
<p id="rfc.section.8.1.p.3">The method consists of a /authz-info endpoint, implemented by the RS.  A client using this method MUST make a POST request to /authz-info at the RS with the access token in the payload. The RS receiving the token MUST verify the validity of the token.  If the token is valid, the RS MUST respond to the POST request with 2.04 (Changed).</p>
<p id="rfc.section.8.1.p.4">If the token is not valid, the RS MUST respond with the CoAP response code 4.01 (Unauthorized).  If the token is valid but the audience of the token does not match the RS, the RS MUST respond with the CoAP response code 4.03 (Forbidden).  </p>
<p id="rfc.section.8.1.p.5">The RS MAY make an introspection request to validate the token before responding to the POST /authz-info request. If the introspection response contains a client token (<a href="#clientToken">Section 7.4</a>) then this token SHALL be included in the payload of the 2.04 (Changed) response.  </p>
<p id="rfc.section.8.1.p.6">Profiles are expected to specify how the /authz-info endpoint is protected.  Note that since the token contains information that allow the client and the RS to establish a security context in the first place, mutual authentication may not be possible at this point.</p>
<h1 id="rfc.section.8.2"><a href="#rfc.section.8.2">8.2.</a> <a href="#tokenValidity" id="tokenValidity">Token Expiration</a></h1>
<p id="rfc.section.8.2.p.1">Depending on the capabilities of the RS, there are various ways in which it can verify the validity of a received access token.  We list the possibilities here including what functionality they require of the RS.</p>
<p/>

<ul>
  <li>The token is a CWT/JWT and includes a 'exp' claim and possibly the 'nbf' claim.  The RS verifies these by comparing them to values from its internal clock as defined in <a href="#RFC7519">[RFC7519]</a>.  In this case the RS's internal clock must reflect the current date and time, or at least be synchronized with the AS's clock.  How this clock synchronization would be performed is out of scope for this memo.</li>
  <li>The RS verifies the validity of the token by performing an introspection request as specified in <a href="#introspectionEndpoint">Section 7</a>.  This requires the RS to have a reliable network connection to the AS and to be able to handle two secure sessions in parallel (C to RS and AS to RS).</li>
  <li>The RS and the AS both store a sequence number linked to their common security association.  The AS increments this number for each access token it issues and includes it in the access token, which is a CWT/JWT.  The RS keeps track of the most recently received sequence number, and only accepts tokens as valid, that are in a certain range around this number.  This method does only require the RS to keep track of the sequence number.  The method does not provide timely expiration, but it makes sure that older tokens cease to be valid after a certain number of newer ones got issued.  For a constrained RS with no network connectivity and no means of reliably measuring time, this is the best that can be achieved.</li>
</ul>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#security" id="security">Security Considerations</a></h1>
<p id="rfc.section.9.p.1">The entire document is about security.  Security considerations applicable to authentication and authorization in RESTful environments provided in OAuth 2.0 <a href="#RFC6749">[RFC6749]</a> apply to this work, as well as the security considerations from <a href="#I-D.ietf-ace-actors">[I-D.ietf-ace-actors]</a>.  Furthermore <a href="#RFC6819">[RFC6819]</a> provides additional security considerations for OAuth which apply to IoT deployments as well.</p>
<p id="rfc.section.9.p.2">A large range of threats can be mitigated by protecting the contents of the access token by using a digital signature or a keyed message digest.  Consequently, the token integrity protection MUST be applied to prevent the token from being modified, particularly since it contains a reference to the symmetric key or the asymmetric key.  If the access token contains the symmetric key, this symmetric key MUST be encrypted by the authorization server with a long-term key shared with the resource server.</p>
<p id="rfc.section.9.p.3">It is important for the authorization server to include the identity of the intended recipient (the audience), typically a single resource server (or a list of resource servers), in the token.  Using a single shared secret with multiple resource servers to simplify key management is NOT RECOMMENDED since the benefit from using the proof-of-possession concept is significantly reduced.</p>
<p id="rfc.section.9.p.4">Token replay is also not possible since an eavesdropper will also have to obtain the corresponding private key or shared secret that is bound to the access token.  Nevertheless, it is good practice to limit the lifetime of the access token and therefore the lifetime of associated key.</p>
<p id="rfc.section.9.p.5">The authorization server MUST offer confidentiality protection for any interactions with the client.  This step is extremely important since the client will obtain the session key from the authorization server for use with a specific access token.  Not using confidentiality protection exposes this secret (and the access token) to an eavesdropper thereby making the proof-of-possession security model completely insecure.  This framework relies on profiles to define how confidentiality protection is provided, and additional protection can be applied by encrypting the CWT as specified in section 5.1 of <a href="#I-D.ietf-ace-cbor-web-token">[I-D.ietf-ace-cbor-web-token]</a> to provide an additional layer of protection for cases where keying material is conveyed, for example, to a hardware security module.</p>
<p id="rfc.section.9.p.6">Developers MUST ensure that the ephemeral credentials (i.e., the private key or the session key) is not leaked to third parties.  An adversary in possession of the ephemeral credentials bound to the access token will be able to impersonate the client.  Be aware that this is a real risk with many constrained environments, since adversaries can often easily get physical access to the devices.</p>
<p id="rfc.section.9.p.7">Clients can at any time request a new proof-of-possession capable access token.  Using a refresh token to regularly request new access tokens that are bound to fresh and unique keys is important if the client has this capability.  Keeping the lifetime of the access token short allows the authorization server to use shorter key sizes, which translate to a performance benefit for the client and for the resource server.  Shorter keys also lead to shorter messages (particularly with asymmetric keying material).</p>
<p id="rfc.section.9.p.8">When authorization servers bind symmetric keys to access tokens then they SHOULD scope these access tokens to a specific permissions.</p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#iana" id="iana">IANA Considerations</a></h1>
<p id="rfc.section.10.p.1">This specification registers new parameters for OAuth and establishes registries for mappings to CBOR.</p>
<h1 id="rfc.section.10.1"><a href="#rfc.section.10.1">10.1.</a> <a href="#IANAOAuthIntrospectionResponseParameterRegistrationn" id="IANAOAuthIntrospectionResponseParameterRegistrationn">OAuth Introspection Response Parameter Registration</a></h1>
<p id="rfc.section.10.1.p.1">This specification registers the following parameters in the OAuth introspection response parameters</p>
<p/>

<ul>
  <li>Name: <samp>cnf</samp></li>
  <li>Description: Key to prove the right to use an access token, as defined in <a href="#RFC7800">[RFC7800]</a>. </li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Name: <samp>aud</samp></li>
  <li>Description: Reference to intended receiving RS, as defined in PoP token specification.</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Name: <samp>profile</samp></li>
  <li>Description: The communication and communication security profile used between client and RS, as defined in ACE profiles.</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Name: <samp>client_token</samp></li>
  <li>Description: Information that the RS MUST pass to the client e.g. about the proof-of-possession keys.</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Name: <samp>rs_cnf</samp></li>
  <li>Description: Describes the public key the RS uses to authenticate.</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<h1 id="rfc.section.10.2"><a href="#rfc.section.10.2">10.2.</a> <a href="#IANAOAuthParameterRegistration" id="IANAOAuthParameterRegistration">OAuth Parameter Registration</a></h1>
<p id="rfc.section.10.2.p.1">This specification registers the following parameters in the OAuth Parameters Registry</p>
<p/>

<ul>
  <li>Parameter name: <samp>profile</samp></li>
  <li>Parameter usage location: token request, and token response</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Name: <samp>cnf</samp></li>
  <li>Description: Key to prove the right to use an access token, as defined in <a href="#RFC7800">[RFC7800]</a>. </li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<h1 id="rfc.section.10.3"><a href="#rfc.section.10.3">10.3.</a> <a href="#IANAOAuthTokenType" id="IANAOAuthTokenType">OAuth Access Token Types</a></h1>
<p id="rfc.section.10.3.p.1">This specification registers the following new token type in the OAuth Access Token Types Registry</p>
<p/>

<ul>
  <li>Name: <samp>PoP</samp></li>
  <li>Description: A proof-of-possession token.</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<h1 id="rfc.section.10.4"><a href="#rfc.section.10.4">10.4.</a> <a href="#IANATokenTypeMappings" id="IANATokenTypeMappings">Token Type Mappings</a></h1>
<p id="rfc.section.10.4.p.1">A new registry will be requested from IANA, entitled "Token Type Mappings".  The registry is to be created as Expert Review Required.</p>
<h1 id="rfc.section.10.4.1"><a href="#rfc.section.10.4.1">10.4.1.</a> <a href="#IANATokenTypeMappingsTemplate" id="IANATokenTypeMappingsTemplate">Registration Template</a></h1>
<p/>

<dl>
  <dt>Token Type:</dt>
  <dd style="margin-left: 8"><br/> Name of token type as registered in the OAuth token type registry e.g. "Bearer".  </dd>
  <dt>Mapped value:</dt>
  <dd style="margin-left: 8"><br/> Integer representation for the token type value.  The key value MUST be an integer in the range of 1 to 65536.  </dd>
  <dt>Change Controller:</dt>
  <dd style="margin-left: 8"><br/> For Standards Track RFCs, list the "IESG". For others, give the name of the responsible party. Other details (e.g., postal address, email address, home page URI) may also be included.  </dd>
  <dt>Specification Document(s):</dt>
  <dd style="margin-left: 8"><br/> Reference to the document or documents that specify the parameter,preferably including URIs that can be used to retrieve copies of the documents. An indication of the relevant sections may also be included but is not required.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.10.4.2"><a href="#rfc.section.10.4.2">10.4.2.</a> <a href="#IANATokenTypeMappingsInitial" id="IANATokenTypeMappingsInitial">Initial Registry Contents</a></h1>
<p/>

<ul>
  <li>Parameter name: <samp>Bearer</samp></li>
  <li>Mapped value: 1</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>pop</samp></li>
  <li>Mapped value: 2</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<h1 id="rfc.section.10.5"><a href="#rfc.section.10.5">10.5.</a> <a href="#IANAJWTClaims" id="IANAJWTClaims">CBOR Web Token Claims</a></h1>
<p id="rfc.section.10.5.p.1">This specification registers the following new claims in the CBOR Web Token (CWT) registry:</p>
<p/>

<ul>
  <li>Claim Name: <samp>scope</samp></li>
  <li>Claim Description: The scope of an access token as defined in <a href="#RFC6749">[RFC6749]</a>.</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Claim Name: <samp>cnf</samp></li>
  <li>Claim Description: The proof-of-possession key of an access token as defined in <a href="#RFC7800">[RFC7800]</a>.</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<h1 id="rfc.section.10.6"><a href="#rfc.section.10.6">10.6.</a> <a href="#IANATokenEndpointCBORMappingsRegistry" id="IANATokenEndpointCBORMappingsRegistry">ACE Profile Registry</a></h1>
<p id="rfc.section.10.6.p.1">A new registry will be requested from IANA, entitled "ACE Profile Registry".  The registry is to be created as Expert Review Required.</p>
<h1 id="rfc.section.10.6.1"><a href="#rfc.section.10.6.1">10.6.1.</a> <a href="#IANATokenEndpointCBORMappingsRegistryTemplate" id="IANATokenEndpointCBORMappingsRegistryTemplate">Registration Template</a></h1>
<p/>

<dl>
  <dt>Profile name:</dt>
  <dd style="margin-left: 8"><br/> Name of the profile to be included in the profile attribute.  </dd>
  <dt>Profile description:</dt>
  <dd style="margin-left: 8"><br/> Text giving an overview of the profile and the context it is developed for.  </dd>
  <dt>Profile ID:</dt>
  <dd style="margin-left: 8"><br/> Integer value to identify the profile.  The value MUST be an integer in the range of 1 to 65536.  </dd>
  <dt>Change Controller:</dt>
  <dd style="margin-left: 8"><br/> For Standards Track RFCs, list the "IESG". For others, give the name of the responsible party. Other details (e.g., postal address, email address, home page URI) may also be included.  </dd>
  <dt>Specification Document(s):</dt>
  <dd style="margin-left: 8"><br/> Reference to the document or documents that specify the parameter,preferably including URIs that can be used to retrieve copies of the documents. An indication of the relevant sections may also be included but is not required.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.10.7"><a href="#rfc.section.10.7">10.7.</a> <a href="#IANAOAuthParameterMappingsRegistry" id="IANAOAuthParameterMappingsRegistry">OAuth Parameter Mappings Registry</a></h1>
<p id="rfc.section.10.7.p.1">A new registry will be requested from IANA, entitled "Token Endpoint CBOR Mappings Registry".  The registry is to be created as Expert Review Required.</p>
<h1 id="rfc.section.10.7.1"><a href="#rfc.section.10.7.1">10.7.1.</a> <a href="#IANAOAuthParameterMappingsRegistryTemplate" id="IANAOAuthParameterMappingsRegistryTemplate">Registration Template</a></h1>
<p/>

<dl>
  <dt>Parameter name:</dt>
  <dd style="margin-left: 8"><br/> OAuth Parameter name, refers to the name in the OAuth parameter registry e.g. "client_id".  </dd>
  <dt>CBOR key value:</dt>
  <dd style="margin-left: 8"><br/> Key value for the claim.  The key value MUST be an integer in the range of 1 to 65536.  </dd>
  <dt>Change Controller:</dt>
  <dd style="margin-left: 8"><br/> For Standards Track RFCs, list the "IESG". For others, give the name of the responsible party. Other details (e.g., postal address, email address, home page URI) may also be included.  </dd>
  <dt>Specification Document(s):</dt>
  <dd style="margin-left: 8"><br/> Reference to the document or documents that specify the parameter,preferably including URIs that can be used to retrieve copies of the documents. An indication of the relevant sections may also be included but is not required.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.10.7.2"><a href="#rfc.section.10.7.2">10.7.2.</a> <a href="#IANATokenEndpointCBORMappingsRegistryInitial" id="IANATokenEndpointCBORMappingsRegistryInitial">Initial Registry Contents</a></h1>
<p/>

<ul>
  <li>Parameter name: <samp>aud</samp></li>
  <li>CBOR key value: 3</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>client_id</samp></li>
  <li>CBOR key value: 8</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>client_secret</samp></li>
  <li>CBOR key value: 9</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>response_type</samp></li>
  <li>CBOR key value: 10</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>redirect_uri</samp></li>
  <li>CBOR key value: 11</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>scope</samp></li>
  <li>CBOR key value: 12</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>state</samp></li>
  <li>CBOR key value: 13</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>code</samp></li>
  <li>CBOR key value: 14</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>error_description</samp></li>
  <li>CBOR key value: 15</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>error_uri</samp></li>
  <li>CBOR key value: 16</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>grant_type</samp></li>
  <li>CBOR key value: 17</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>access_token</samp></li>
  <li>CBOR key value: 18</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>token_type</samp></li>
  <li>CBOR key value: 19</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>expires_in</samp></li>
  <li>CBOR key value: 20</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>username</samp></li>
  <li>CBOR key value: 21</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>password</samp></li>
  <li>CBOR key value: 22</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>refresh_token</samp></li>
  <li>CBOR key value: 23</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>cnf</samp></li>
  <li>CBOR key value: 24</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>profile</samp></li>
  <li>CBOR key value: 25</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<h1 id="rfc.section.10.8"><a href="#rfc.section.10.8">10.8.</a> <a href="#IANAIntrospectionEndpointCBORMappingsRegistry" id="IANAIntrospectionEndpointCBORMappingsRegistry">Introspection Endpoint CBOR Mappings Registry</a></h1>
<p id="rfc.section.10.8.p.1">A new registry will be requested from IANA, entitled "Introspection Endpoint CBOR Mappings Registry".  The registry is to be created as Expert Review Required.</p>
<h1 id="rfc.section.10.8.1"><a href="#rfc.section.10.8.1">10.8.1.</a> <a href="#IANAIntrospectionEndpointCBORMappingsRegistryTemplate" id="IANAIntrospectionEndpointCBORMappingsRegistryTemplate">Registration Template</a></h1>
<p/>

<dl>
  <dt>Response parameter name:</dt>
  <dd style="margin-left: 8"><br/> Name of the response parameter as defined in the "OAuth Token Introspection Response" registry e.g. "active".  </dd>
  <dt>CBOR key value:</dt>
  <dd style="margin-left: 8"><br/> Key value for the claim.  The key value MUST be an integer in the range of 1 to 65536.  </dd>
  <dt>Change Controller:</dt>
  <dd style="margin-left: 8"><br/> For Standards Track RFCs, list the "IESG". For others, give the name of the responsible party. Other details (e.g., postal address, email address, home page URI) may also be included.  </dd>
  <dt>Specification Document(s):</dt>
  <dd style="margin-left: 8"><br/> Reference to the document or documents that specify the parameter,preferably including URIs that can be used to retrieve copies of the documents. An indication of the relevant sections may also be included but is not required.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.10.8.2"><a href="#rfc.section.10.8.2">10.8.2.</a> <a href="#IANAIntrospectionEndpointCBORMappingsRegistryInitial" id="IANAIntrospectionEndpointCBORMappingsRegistryInitial">Initial Registry Contents</a></h1>
<p/>

<ul>
  <li>Response parameter name: <samp>iss</samp></li>
  <li>CBOR key value: 1</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>sub</samp></li>
  <li>CBOR key value: 2</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>aud</samp></li>
  <li>CBOR key value: 3</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>exp</samp></li>
  <li>CBOR key value: 4</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>nbf</samp></li>
  <li>CBOR key value: 5</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>iat</samp></li>
  <li>CBOR key value: 6</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>cti</samp></li>
  <li>CBOR key value: 7</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>client_id</samp></li>
  <li>CBOR key value: 8</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>scope</samp></li>
  <li>CBOR key value: 12</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>token_type</samp></li>
  <li>CBOR key value: 19</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>username</samp></li>
  <li>CBOR key value: 21</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>cnf</samp></li>
  <li>CBOR key value: 24</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Parameter name: <samp>profile</samp></li>
  <li>CBOR key value: 25</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>token</samp></li>
  <li>CBOR key value: 26</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>token_type_hint</samp></li>
  <li>CBOR key value: 27</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>active</samp></li>
  <li>CBOR key value: 28</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>client_token</samp></li>
  <li>CBOR key value: 29</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<p/>

<ul>
  <li>Response parameter name: <samp>rs_cnf</samp></li>
  <li>CBOR key value: 30</li>
  <li>Change Controller: IESG</li>
  <li>Specification Document(s): this document</li>
</ul>

<p> </p>
<h1 id="rfc.section.10.9"><a href="#rfc.section.10.9">10.9.</a> <a href="#CoAPOptionNumberRegistration" id="CoAPOptionNumberRegistration">CoAP Option Number Registration</a></h1>
<p id="rfc.section.10.9.p.1">This section registers the "Access-Token" CoAP Option Number in the "CoRE Parameters" sub-registry "CoAP Option Numbers" in the manner described in <a href="#RFC7252">[RFC7252]</a>.  </p>
<p/>

<dl>
  <dt>Name</dt>
  <dd style="margin-left: 8"><br/><br/> Access-Token </dd>
  <dt>Number</dt>
  <dd style="margin-left: 8"><br/><br/> TBD </dd>
  <dt>Reference</dt>
  <dd style="margin-left: 8"><br/><br/> [This document].  </dd>
  <dt>Meaning in Request</dt>
  <dd style="margin-left: 8"><br/><br/> Contains an Access Token according to [This document] containing access permissions of the client.  </dd>
  <dt>Meaning in Response</dt>
  <dd style="margin-left: 8"><br/><br/> Not used in response </dd>
  <dt>Safe-to-Forward</dt>
  <dd style="margin-left: 8"><br/><br/> Yes </dd>
  <dt>Format</dt>
  <dd style="margin-left: 8"><br/><br/> Based on the observer the format is perceived differently.  Opaque data to the client and CWT or reference token to the RS.  </dd>
  <dt>Length</dt>
  <dd style="margin-left: 8"><br/><br/> Less then 255 bytes </dd>
</dl>

<p> </p>
<h1 id="rfc.section.11"><a href="#rfc.section.11">11.</a> <a href="#Acknowledgments" id="Acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.11.p.1">We would like to thank Eve Maler for her contributions to the use of OAuth 2.0 and UMA in IoT scenarios, Robert Taylor for his discussion input, and Malisa Vucinic for his input on the ACRE proposal <a href="#I-D.seitz-ace-core-authz">[I-D.seitz-ace-core-authz]</a> which was one source of inspiration for this work. Finally, we would like to thank the ACE working group in general for their feedback.</p>
<p id="rfc.section.11.p.2">We would like to thank the authors of draft-ietf-oauth-pop-key-distribution, from where we copied large parts of our security considerations.</p>
<p id="rfc.section.11.p.3">Ludwig Seitz and Goeran Selander worked on this document as part of the CelticPlus project CyberWI, with funding from Vinnova.</p>
<h1 id="rfc.references"><a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">12.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-ace-cbor-web-token">[I-D.ietf-ace-cbor-web-token]</b>
      </td>
      <td class="top"><a>Wahlstroem, E.</a>, <a>Jones, M.</a>, <a>Tschofenig, H.</a> and <a>S. Erdtman</a>, "<a href="http://tools.ietf.org/html/draft-ietf-ace-cbor-web-token-01">CBOR Web Token (CWT)</a>", Internet-Draft draft-ietf-ace-cbor-web-token-01, July 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-cose-msg">[I-D.ietf-cose-msg]</b>
      </td>
      <td class="top"><a>Schaad, J.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-cose-msg-23">CBOR Object Signing and Encryption (COSE)</a>", Internet-Draft draft-ietf-cose-msg-23, October 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6347">[RFC6347]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a> and <a>N. Modadugu</a>, "<a href="http://tools.ietf.org/html/rfc6347">Datagram Transport Layer Security Version 1.2</a>", RFC 6347, DOI 10.17487/RFC6347, January 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7252">[RFC7252]</b>
      </td>
      <td class="top"><a>Shelby, Z.</a>, <a>Hartke, K.</a> and <a>C. Bormann</a>, "<a href="http://tools.ietf.org/html/rfc7252">The Constrained Application Protocol (CoAP)</a>", RFC 7252, DOI 10.17487/RFC7252, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7662">[RFC7662]</b>
      </td>
      <td class="top"><a>Richer, J.</a>, "<a href="http://tools.ietf.org/html/rfc7662">OAuth 2.0 Token Introspection</a>", RFC 7662, DOI 10.17487/RFC7662, October 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7800">[RFC7800]</b>
      </td>
      <td class="top"><a>Jones, M.</a>, <a>Bradley, J.</a> and <a>H. Tschofenig</a>, "<a href="http://tools.ietf.org/html/rfc7800">Proof-of-Possession Key Semantics for JSON Web Tokens (JWTs)</a>", RFC 7800, DOI 10.17487/RFC7800, April 2016.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">12.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-ace-actors">[I-D.ietf-ace-actors]</b>
      </td>
      <td class="top"><a>Gerdes, S.</a>, <a>Seitz, L.</a>, <a>Selander, G.</a> and <a>C. Bormann</a>, "<a href="http://tools.ietf.org/html/draft-ietf-ace-actors-04">An architecture for authorization in constrained environments</a>", Internet-Draft draft-ietf-ace-actors-04, September 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-oauth-device-flow">[I-D.ietf-oauth-device-flow]</b>
      </td>
      <td class="top"><a>Denniss, W.</a>, <a>Myrseth, S.</a>, <a>Bradley, J.</a>, <a>Jones, M.</a> and <a>H. Tschofenig</a>, "<a href="http://tools.ietf.org/html/draft-ietf-oauth-device-flow-03">OAuth 2.0 Device Flow</a>", Internet-Draft draft-ietf-oauth-device-flow-03, July 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-oauth-native-apps">[I-D.ietf-oauth-native-apps]</b>
      </td>
      <td class="top"><a>Denniss, W.</a> and <a>J. Bradley</a>, "<a href="http://tools.ietf.org/html/draft-ietf-oauth-native-apps-05">OAuth 2.0 for Native Apps</a>", Internet-Draft draft-ietf-oauth-native-apps-05, October 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.seitz-ace-core-authz">[I-D.seitz-ace-core-authz]</b>
      </td>
      <td class="top"><a>Seitz, L.</a>, <a>Selander, G.</a> and <a>M. Vucinic</a>, "<a href="http://tools.ietf.org/html/draft-seitz-ace-core-authz-00">Authorization for Constrained RESTful Environments</a>", Internet-Draft draft-seitz-ace-core-authz-00, June 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.selander-ace-object-security">[I-D.selander-ace-object-security]</b>
      </td>
      <td class="top"><a>Selander, G.</a>, <a>Mattsson, J.</a>, <a>Palombini, F.</a> and <a>L. Seitz</a>, "<a href="http://tools.ietf.org/html/draft-selander-ace-object-security-06">Object Security of CoAP (OSCOAP)</a>", Internet-Draft draft-selander-ace-object-security-06, October 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4949">[RFC4949]</b>
      </td>
      <td class="top"><a>Shirey, R.</a>, "<a href="http://tools.ietf.org/html/rfc4949">Internet Security Glossary, Version 2</a>", FYI 36, RFC 4949, DOI 10.17487/RFC4949, August 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5246">[RFC5246]</b>
      </td>
      <td class="top"><a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, DOI 10.17487/RFC5246, August 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6690">[RFC6690]</b>
      </td>
      <td class="top"><a>Shelby, Z.</a>, "<a href="http://tools.ietf.org/html/rfc6690">Constrained RESTful Environments (CoRE) Link Format</a>", RFC 6690, DOI 10.17487/RFC6690, August 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6749">[RFC6749]</b>
      </td>
      <td class="top"><a>Hardt, D.</a>, "<a href="http://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>", RFC 6749, DOI 10.17487/RFC6749, October 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6819">[RFC6819]</b>
      </td>
      <td class="top"><a>Lodderstedt, T.</a>, <a>McGloin, M.</a> and <a>P. Hunt</a>, "<a href="http://tools.ietf.org/html/rfc6819">OAuth 2.0 Threat Model and Security Considerations</a>", RFC 6819, DOI 10.17487/RFC6819, January 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7049">[RFC7049]</b>
      </td>
      <td class="top"><a>Bormann, C.</a> and <a>P. Hoffman</a>, "<a href="http://tools.ietf.org/html/rfc7049">Concise Binary Object Representation (CBOR)</a>", RFC 7049, DOI 10.17487/RFC7049, October 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7159">[RFC7159]</b>
      </td>
      <td class="top"><a>Bray, T.</a>, "<a href="http://tools.ietf.org/html/rfc7159">The JavaScript Object Notation (JSON) Data Interchange Format</a>", RFC 7159, DOI 10.17487/RFC7159, March 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7228">[RFC7228]</b>
      </td>
      <td class="top"><a>Bormann, C.</a>, <a>Ersue, M.</a> and <a>A. Keranen</a>, "<a href="http://tools.ietf.org/html/rfc7228">Terminology for Constrained-Node Networks</a>", RFC 7228, DOI 10.17487/RFC7228, May 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7231">[RFC7231]</b>
      </td>
      <td class="top"><a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>", RFC 7231, DOI 10.17487/RFC7231, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7519">[RFC7519]</b>
      </td>
      <td class="top"><a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="http://tools.ietf.org/html/rfc7519">JSON Web Token (JWT)</a>", RFC 7519, DOI 10.17487/RFC7519, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7521">[RFC7521]</b>
      </td>
      <td class="top"><a>Campbell, B.</a>, <a>Mortimore, C.</a>, <a>Jones, M.</a> and <a>Y. Goland</a>, "<a href="http://tools.ietf.org/html/rfc7521">Assertion Framework for OAuth 2.0 Client Authentication and Authorization Grants</a>", RFC 7521, DOI 10.17487/RFC7521, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7591">[RFC7591]</b>
      </td>
      <td class="top"><a>Richer, J.</a>, <a>Jones, M.</a>, <a>Bradley, J.</a>, <a>Machulak, M.</a> and <a>P. Hunt</a>, "<a href="http://tools.ietf.org/html/rfc7591">OAuth 2.0 Dynamic Client Registration Protocol</a>", RFC 7591, DOI 10.17487/RFC7591, July 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7744">[RFC7744]</b>
      </td>
      <td class="top"><a>Seitz, L.</a>, <a>Gerdes, S.</a>, <a>Selander, G.</a>, <a>Mani, M.</a> and <a>S. Kumar</a>, "<a href="http://tools.ietf.org/html/rfc7744">Use Cases for Authentication and Authorization in Constrained Environments</a>", RFC 7744, DOI 10.17487/RFC7744, January 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7959">[RFC7959]</b>
      </td>
      <td class="top"><a>Bormann, C.</a> and <a>Z. Shelby</a>, "<a href="http://tools.ietf.org/html/rfc7959">Block-Wise Transfers in the Constrained Application Protocol (CoAP)</a>", RFC 7959, DOI 10.17487/RFC7959, August 2016.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#constraints" id="constraints">Design Justification</a></h1>
<p id="rfc.section.A.p.1">This section provides further insight into the design decisions of the solution documented in this document.  <a href="#overview">Section 3</a> lists several building blocks and briefly summarizes their importance.  The justification for offering some of those building blocks, as opposed to using OAuth 2.0 as is, is given below.</p>
<p id="rfc.section.A.p.2">Common IoT constraints are: </p>

<dl>
  <dt>Low Power Radio:</dt>
  <dd style="margin-left: 8"><br/><br/> Many IoT devices are equipped with a small battery which needs to last for a long time.  For many constrained wireless devices the highest energy cost is associated to transmitting or receiving messages.  It is therefore important to keep the total communication overhead low, including minimizing the number and size of messages sent and received, which has an impact of choice on the message format and protocol.  By using CoAP over UDP, and CBOR encoded messages some of these aspects are addressed.  Security protocols contribute to the communication overhead and can in some cases be optimized.  For example authentication and key establishment may in certain cases where security requirements so allows be replaced by provisioning of security context by a trusted third party, using transport or application layer security.<br/> </dd>
  <dt>Low CPU Speed:</dt>
  <dd style="margin-left: 8"><br/><br/> Some IoT devices are equipped with processors that are significantly slower than those found in most current devices on the Internet.  This typically has implications on what timely cryptographic operations a device is capable to perform, which in turn impacts e.g. protocol latency.  Symmetric key cryptography may be used instead of the computationally more expensive public key cryptography where the security requirements so allows, but this may also require support for trusted third party assisted secret key establishment using transport or application layer security.  <br/> </dd>
  <dt>Small Amount of Memory:</dt>
  <dd style="margin-left: 8"><br/><br/> Microcontrollers embedded in IoT devices are often equipped with small amount of RAM and flash memory, which places limitations what kind of processing can be performed and how much code can be put on those devices.  To reduce code size fewer and smaller protocol implementations can be put on the firmware of such a device.  In this case, CoAP may be used instead of HTTP,  symmetric key cryptography instead of public key cryptography, and CBOR instead of JSON.  Authentication and key establishment protocol, e.g. the DTLS handshake,  in comparison with assisted key establishment also has an impact on memory and code.<br/> </dd>
  <dt>User Interface Limitations:</dt>
  <dd style="margin-left: 8"><br/><br/> Protecting access to resources is both an important security as well as privacy feature.  End users and enterprise customers do not want to give access to the data collected by their IoT device or to functions it may offer to third parties.  Since the classical approach of requesting permissions from end users via a rich user interface does not work in many IoT deployment scenarios these functions need to be delegated to user controlled devices that are better suitable for such tasks, such as smart phones and tablets.  <br/></dd>
  <dt>Communication Constraints:</dt>
  <dd style="margin-left: 8"><br/><br/> In certain constrained settings an IoT device may not be able to communicate with a given device at all times.  Devices may be sleeping, or just disconnected from the Internet because of general lack of connectivity in the area, for cost reasons, or for security reasons, e.g. to avoid an entry point for Denial-of-Service attacks.  <br/><br/> The communication interactions this framework builds upon (as shown graphically in <a href="#fig:protocolFlow">Figure 1</a>) may be accomplished using a variety of different protocols, and not all parts of the message flow are used in all applications due to the communication constraints.  While we envision deployments to make use of CoAP we explicitly want to support HTTP, HTTP/2 or specific protocols, such as Bluetooth Smart communication, which does not necessarily use IP.  The latter raises the  need for application layer security over the various interfaces.  </dd>
</dl>

<p> </p>
<h1 id="rfc.appendix.B"><a href="#rfc.appendix.B">Appendix B.</a> <a href="#app:rolesAndResponsibilities" id="app:rolesAndResponsibilities">Roles and Responsibilites</a></h1>
<p/>

<dl>
  <dt>Resource Owner</dt>
  <dd style="margin-left: 8"><ul><li>Make sure that the RS is registered at the AS.  This includes making known to the AS which profiles, token_types, scopes, and key types (symmetric/asymmetric) the RS supports. Also making it known to the AS which audience(s) the RS identifies itself with.</li><li>Make sure that clients can discover the AS which is in charge of the RS.</li><li>Make sure that the AS has the necessary, up-to-date, access control policies for the RS.</li></ul><p> </p><br/> </dd>
  <dt>Requesting Party</dt>
  <dd style="margin-left: 8"><ul><li>Make sure that the client is provisioned the necessary credentials to authenticate to the AS.</li><li>Make sure that the client is configured to follow the security requirements of the Requesting Party, when issuing requests (e.g. minimum communication security requirements, trust anchors).</li><li>Register the client at the AS.  This includes making known to the AS which profiles, token_types, and key types (symmetric/asymmetric) the client.</li></ul><p> </p><br/> </dd>
  <dt>Authorization Server</dt>
  <dd style="margin-left: 8"><ul><li>Register RS and manage corresponding security contexts.</li><li>Register clients and including authentication credentials.</li><li>Allow Resource Owners to configure and update access control policies related to their registered RS'</li><li>Expose the /token endpoint to allow  clients to request tokens.</li><li>Authenticate clients that wish to request a token.</li><li>Process a token request against the authorization policies configured for the RS.</li><li>Expose the /introspection endpoint that allows RS's to submit token introspection requests.</li><li>Authenticate RS's that wish to get an introspection response.</li><li>Process token introspection requests.</li><li>Optionally: Handle token revocation.</li></ul><br/> </dd>
  <dt>Client</dt>
  <dd style="margin-left: 8"><ul><li>Discover the AS in charge of the RS that is to be targeted with a request.</li><li>Submit the token request (A).  <ul><li>Authenticate towards the AS.</li><li>Optionally (if not pre-configured): Specify which RS, which resource(s), and which action(s) the request(s) will target.</li><li>If raw public key (rpk) or certificate is used, make sure the AS has the right rpk or certificate for this client.</li></ul><p> </p></li><li>Process the access token and RS Information (B) <ul><li>Check that the RS Information provides the necessary security parameters (e.g. PoP key, information on communication security protocols supported by the RS).</li></ul><p> </p></li><li>Send the token and request to the RS (C) <ul><li>Authenticate towards the RS (this could coincide with the proof of possession process).</li><li>Transmit the token as specified by the AS (default is to the /authz-info endpoint, alternative options are specified by profiles).</li><li>Perform the proof-of-possession procedure as specified by the profile in use (this may already have been taken care of through the authentication procedure).</li></ul><p> </p></li><li>Process the RS response (F) requirements of the Requesting Party, when issuing requests (e.g. minimum communication security requirements, trust anchors).</li><li>Register the client at the AS.</li></ul><br/> </dd>
  <dt>Resource Server</dt>
  <dd style="margin-left: 8">
    <ul>
      <li>Expose a way to submit access tokens. By default this is the /authz-info endpoint.</li>
      <li>Process an access token.  <ul><li>Verify the token is from the right AS.</li><li>Verify that the token applies to this RS.</li><li>Check that the token has not expired (if the token provides expiration information).</li><li>Check the token's integrity.</li><li>Store the token so that it can be retrieved in the context of a matching request.</li></ul><p> </p></li>
      <li>Process a request.  <ul><li>Set up communication security with the client.</li><li>Authenticate the client.</li><li>Match the client against existing tokens.</li><li>Check that tokens belonging to the client actually authorize the requested action.</li><li>Optionally: Check that the matching tokens are still valid, using introspection (if this is possible.)</li></ul><p> </p></li>
      <li>Send a response following the agreed upon communication security.</li>
    </ul>
    <p> </p>
  </dd>
</dl>
<h1 id="rfc.appendix.C"><a href="#rfc.appendix.C">Appendix C.</a> <a href="#profileRequirements" id="profileRequirements">Requirements on Profiles</a></h1>
<p id="rfc.section.C.p.1">This section lists the requirements on profiles of this framework, for the convenience of a profile designer.  All this information is also given in the appropriate sections of the main document, this is just meant as a checklist, to make it more easy to spot parts one might have missed.  </p>

<ul>
  <li>Specify the discovery process of how the client finds the right AS for an RS it wants to send a request to.</li>
  <li>Specify the communication protocol the client and RS the must use (e.g. CoAP).</li>
  <li>Specify the security protocol the client and RS must use to protect their communication (e.g. OSCOAP or DTLS over CoAP).  This must provide encryption and integrity protection.</li>
  <li>Specify how the client and the RS mutually authenticate</li>
  <li>Specify the Content-format of the protocol messages (e.g. "application/cbor" or "application/cose+cbor").</li>
  <li>Specify the proof-of-possession protocol(s) and how to select one, if several are available.  Also specify which key types (e.g. symmetric/asymmetric) are supported by a specific proof-of-possession protocol.</li>
  <li>Specify a unique profile identifier.</li>
  <li>Optionally specify how the RS talks to the AS for introspection.</li>
  <li>Optionally specify how the client talks to the AS for requesting a token.</li>
  <li>Specify how/if the /authz-info endpoint is protected.</li>
  <li>Optionally define other methods of token transport than the /authz-info endpoint.</li>
</ul>

<p> </p>
<h1 id="rfc.appendix.D"><a href="#rfc.appendix.D">Appendix D.</a> <a href="#options" id="options">Deployment Examples</a></h1>
<p id="rfc.section.D.p.1">There is a large variety of IoT deployments, as is indicated in <a href="#constraints">Appendix A</a>, and this section highlights a few common variants.  This section is not normative but illustrates how the framework can be applied.  </p>
<p id="rfc.section.D.p.2">For each of the deployment variants there are a number of possible security setups between clients, resource servers and authorization servers.  The main focus in the following subsections is on how authorization of a client request for a resource hosted by a RS is performed.  This requires the the security of the requests and responses between the clients and the RS to consider.  </p>
<p id="rfc.section.D.p.3">Note: CBOR diagnostic notation is used for examples of requests and responses.</p>
<h1 id="rfc.appendix.D.1"><a href="#rfc.appendix.D.1">D.1.</a> <a href="#localTokenValidation" id="localTokenValidation">Local Token Validation</a></h1>
<p id="rfc.section.D.1.p.1">In this scenario we consider the case where the resource server is offline, i.e. it is not connected to the AS at the time of the access request.  This access procedure involves steps A, B, C, and F of <a href="#fig:protocolFlow">Figure 1</a>.  </p>
<p id="rfc.section.D.1.p.2">Since the resource server must be able to verify the access token locally, self-contained access tokens must be used.</p>
<p id="rfc.section.D.1.p.3">This example shows the interactions between a client, the authorization server and a temperature sensor acting as a resource server.  Message exchanges A and B are shown in <a href="#fig:RSOffline">Figure 16</a>.</p>
<p/>

<dl>
  <dt></dt>
  <dd style="margin-left: 8">A: The client first generates a public-private key pair used for communication security with the RS.</dd>
  <dt></dt>
  <dd style="margin-left: 8">The client sends the POST request to /token at the AS.  The security of this request can be transport or application layer, it is up the the comunication security profile to define. In the example trasport layer identification of the AS is done and the client identifies with client_id and client_secret as in classic OAuth.  The request contains the public key of the client and the Audience parameter set to "tempSensorInLivingRoom", a value that the temperature sensor identifies itself with.  The AS evaluates the request and authorizes the client to access the resource.</dd>
  <dt></dt>
  <dd style="margin-left: 8">B: The AS responds with a PoP token and RS Information.  The PoP token contains the public key of the client, and the RS Information contains the public key of the RS.  For communication security this example uses DTLS RawPublicKey between the client and the RS. The issued token will have a short validity time, i.e. 'exp' close to 'iat', to protect the RS from replay attacks. The token includes the claim such as "scope" with the authorized access that an owner of the temperature device can enjoy.  In this example, the 'scope' claim, issued by the AS, informs the RS that the owner of the token, that can prove the possession of a key is authorized to make a GET request against the /temperature resource and a POST request on the /firmware resource.  Note that the syntax and semantics of the scope claim are application specific.</dd>
  <dt></dt>
  <dd style="margin-left: 8">Note: In this example we assume that the client knows what resource it wants to access, and is therefore able to request specific audience and scope claims for the access token.</dd>
</dl>
<div id="rfc.figure.16"/>
<div id="fig:RSOffline"/>
<pre>
         Authorization
  Client    Server
    |         |
    |&lt;=======&gt;| DTLS Connection Establishment
    |         |   to identify the AS
    |         |
A:  +--------&gt;| Header: POST (Code=0.02)
    |  POST   | Uri-Path:"token"
    |         | Content-Type: application/cbor
    |         | Payload: &lt;Request-Payload&gt;
    |         |
B:  |&lt;--------+ Header: 2.05 Content
    |  2.05   | Content-Type: application/cbor
    |         | Payload: &lt;Response-Payload&gt;
    |         |
        </pre>
<p class="figure">Figure 16: Token Request and Response Using Client Credentials.</p>
<p/>
<div id="rfc.figure.17"/>
<div id="fig:RSOfflineReq"/>
<pre>
Request-Payload :
{
  "grant_type" : "client_credentials",
  "aud" : "tempSensorInLivingRoom",
  "client_id" : "myclient",
  "client_secret" : "qwerty"
}

Response-Payload :
{
  "access_token" : b64'SlAV32hkKG ...',
  "token_type" : "pop",
  "csp" : "DTLS",
  "cnf" : {
    "COSE_Key" : {
      "kid" : b64'c29tZSBwdWJsaWMga2V5IGlk',
      "kty" : "EC",
      "crv" : "P-256",
      "x"   : b64'MKBCTNIcKUSDii11ySs3526iDZ8AiTo7Tu6KPAqv7D4',
      "y"   : b64'4Etl6SRW2YiLUrN5vfvVHuhp7x8PxltmWWlbbM4IFyM'
    }
  }
}
        </pre>
<p class="figure">Figure 17: Request and Response Payload Details.</p>
<p id="rfc.section.D.1.p.6">The information contained in the Request-Payload and the Response-Payload is shown in <a href="#fig:RSOfflineReq">Figure 17</a>.  Note that we assume a DTLS-based communication security profile for this example, therefore the Content-Type is "application/cbor".  </p>
<p id="rfc.section.D.1.p.7">The content of the access token is shown in  <a href="#fig:BothcborMappingValueAsymmetricCWT">Figure 18</a>.</p>
<div id="rfc.figure.18"/>
<div id="fig:BothcborMappingValueAsymmetricCWT"/>
<pre>
{
  "aud" : "tempSensorInLivingRoom",
  "iat" : "1360189224",
  "exp" : "1360289224",
  "scope" :  "temperature_g firmware_p",
  "cnf" : {
    "jwk" : {
      "kid" : b64'1Bg8vub9tLe1gHMzV76e8',
      "kty" : "EC",
      "crv" : "P-256",
      "x" : b64'f83OJ3D2xF1Bg8vub9tLe1gHMzV76e8Tus9uPHvRVEU',
      "y" : b64'x_FEzRu9m36HLN_tue659LNpXW6pCyStikYjKIWI5a0'
    }
  }
}
        </pre>
<p class="figure">Figure 18: Access Token including Public Key of the Client.</p>
<p/>
<div id="rfc.figure.19"/>
<div id="fig:RSOfflinePostAccessTokenAsymmetric"/>
<pre>
           Resource
 Client     Server
    |         |
C:  +--------&gt;| Header: POST (Code=0.02)
    |  POST   | Uri-Path:"authz-info"
    |         | Payload: SlAV32hkKG ...
    |         |
    |&lt;--------+ Header: 2.04 Changed
    |  2.04   |
    |         |
</pre>
<p class="figure">Figure 19: Access Token provisioning to RS</p>
<p id="rfc.section.D.1.p.9">Messages C and F are shown in <a href="#fig:RSOfflinePostAccessTokenAsymmetric">Figure 19</a> - <a href="#fig:RSOfflineDTLSRequestAndResponse">Figure 20</a>.  </p>

<dl>
  <dt></dt>
  <dd style="margin-left: 8">C: The client then sends the PoP token to the /authz-info endpoint at the RS.  This is a plain CoAP request, i.e. no transport or application layer security between client and RS, since the token is integrity protected between AS and RS.  The RS verifies that the PoP token was created by a known and trusted AS, is valid, and responds to the client.  The RS caches the security context together with authorization information about this client contained in the PoP token.</dd>
  <dt></dt>
  <dd style="margin-left: 8"/>
  <dt></dt>
  <dd style="margin-left: 8">The client and the RS runs the DTLS handshake using the raw public keys established in step B and C.</dd>
  <dt></dt>
  <dd style="margin-left: 8">The client sends the CoAP request GET to /temperature on RS over DTLS.  The RS verifies that the request is authorized, based on previously established security context.</dd>
  <dt></dt>
  <dd style="margin-left: 8">F: The RS responds with a resource representation over DTLS.</dd>
</dl>
<div id="rfc.figure.20"/>
<div id="fig:RSOfflineDTLSRequestAndResponse"/>
<pre>
           Resource
 Client     Server
    |         |
    |&lt;=======&gt;| DTLS Connection Establishment
    |         |   using Raw Public Keys
    |         |
    +--------&gt;| Header: GET (Code=0.01)
    | GET     | Uri-Path: "temperature"
    |         |
    |         |
    |         |
F:  |&lt;--------+ Header: 2.05 Content
    | 2.05    | Payload: &lt;sensor value&gt;
    |         |
      </pre>
<p class="figure">Figure 20: Resource Request and Response protected by DTLS.</p>
<p/>
<h1 id="rfc.appendix.D.2"><a href="#rfc.appendix.D.2">D.2.</a> <a href="#introspectionAidedTokenValidation" id="introspectionAidedTokenValidation">Introspection Aided Token Validation</a></h1>
<p id="rfc.section.D.2.p.1">In this deployment scenario we assume that a client is not able to access the AS at the time of the access request.  Since the RS is, however, connected to the back-end infrastructure it can make use of token introspection.  This access procedure involves steps A-F of <a href="#fig:protocolFlow">Figure 1</a>, but assumes steps A and B have been carried out during a phase when the client had connectivity to AS.  </p>
<p id="rfc.section.D.2.p.2">Since the client is assumed to be offline, at least for a certain period of time, a pre-provisioned access token has to be long-lived.  The resource server may use its online connectivity to validate the access token with the authorization server, which is shown in the example below.</p>
<p id="rfc.section.D.2.p.3">In the example interactions between an offline client (key fob), a RS (online lock), and an AS is shown.  We assume that there is a provisioning step where the client has access to the AS.  This corresponds to message exchanges A and B which are shown in <a href="#fig:cOffline">Figure 21</a>.  </p>
<p id="rfc.section.D.2.p.4">Authorization consent from the resource owner can be pre-configured, but it can also be provided via an interactive flow with the resource owner.  An example of this for the key fob case could be that the resource owner has a connected car, he buys a generic key that he wants to use with the car.  To authorize the key fob he connects it to his computer that then provides the UI for the device.  After that OAuth 2.0 implicit flow can used to authorize the key for his car at the the car manufacturers AS.</p>
<p id="rfc.section.D.2.p.5">Note: In this example the client does not know the exact door it will be used to access since the token request is not send at the time of access. So the scope and audience parameters is set quite wide to start with and new values different form the original once can be returned from introspection later on.</p>
<p/>

<dl>
  <dt></dt>
  <dd style="margin-left: 8">A: The client sends the request using POST to /token at AS.  The request contains the Audience parameter set to  "PACS1337" (PACS, Physical Access System), a value the that the online door in question identifies itself with.  The AS generates an access token as on opaque string, which it can match to the specific client, a targeted audience and a symmetric key. The security is provided by identifying the AS on transport layer using a pre shared security context (psk, rpk or certificate) and then the client is identified using client_id and client_secret as in classic OAuth</dd>
  <dt></dt>
  <dd style="margin-left: 8">B: The AS responds with the an access token and RS Information, the latter containing a symmetric key.  Communication security between C and RS will be DTLS and PreSharedKey.  The PoP key being used as the PreSharedKey.  </dd>
</dl>

<p> </p>
<div id="rfc.figure.21"/>
<div id="fig:cOffline"/>
<pre>

         Authorization
 Client     Server
    |         |
    |         |
A:  +--------&gt;| Header: POST (Code=0.02)
    |  POST   | Uri-Path:"token"
    |         | Content-Type: application/cbor
    |         | Payload: &lt;Request-Payload&gt;
    |         |
B:  |&lt;--------+ Header: 2.05 Content
    |         | Content-Type: application/cbor
    |  2.05   | Payload: &lt;Response-Payload&gt;
    |         |
    </pre>
<p class="figure">Figure 21: Token Request and Response using Client Credentials.</p>
<p/>
<div id="rfc.figure.22"/>
<div id="fig:cOfflineReq"/>
<pre>
Request-Payload:
{
  "grant_type" : "client_credentials",
  "aud" : "lockOfDoor4711",
  "client_id" : "keyfob",
  "client_secret" : "qwerty"
}

Response-Payload:
{
  "access_token" : b64'SlAV32hkKG ...'
  "token_type" : "pop",
  "csp" : "DTLS",
  "cnf" : {
    "COSE_Key" : {
      "kid" : b64'c29tZSBwdWJsaWMga2V5IGlk',
      "kty" : "oct",
      "alg" : "HS256",
      "k": b64'ZoRSOrFzN_FzUA5XKMYoVHyzff5oRJxl-IXRtztJ6uE'
    }
  }
}
      </pre>
<p class="figure">Figure 22: Request and Response Payload for C offline</p>
<p id="rfc.section.D.2.p.8">The information contained in the Request-Payload and the Response-Payload is shown in <a href="#fig:cOfflineReq">Figure 22</a>.  </p>
<p id="rfc.section.D.2.p.9">The access token in this case is just an opaque string referencing the authorization information at the AS.</p>
<div id="rfc.figure.23"/>
<div id="fig:cOfflineIntrospection"/>
<pre>
           Resource
  Client    Server
    |         |
C:  +--------&gt;| Header: POST (T=CON, Code=0.02)
    |  POST   | Uri-Path:"authz-info"
    |         | Content-Type: "application/cbor"
    |         | Payload: b64'SlAV32hkKG ...''
    |         |
    |         |     Authorization
    |         |       Server
    |         |          |
    |      D: +---------&gt;| Header: POST (Code=0.02)
    |         |  POST    | Uri-Path: "introspect"
    |         |          | Content-Type: "application/cbor"
    |         |          | Payload: &lt;Request-Payload&gt;
    |         |          |
    |      E: |&lt;---------+ Header: 2.05 Content
    |         |  2.05    | Content-Type: "application/cbor"
    |         |          | Payload: &lt;Response-Payload&gt;
    |         |          |
    |         |
    |&lt;--------+ Header: 2.01 Created
    |  2.01   |
    |         |
</pre>
<p class="figure">Figure 23: Token Introspection for C offline</p>
<div id="rfc.figure.24"/>
<div id="fig:cOfflineIntroReq"/>
<pre>
Request-Payload:
{
  "token" : b64'SlAV32hkKG...',
  "client_id" : "FrontDoor",
  "client_secret" : "ytrewq"
}

Response-Payload:
{
  "active" : true,
  "aud" : "lockOfDoor4711",
  "scope" : "open, close",
  "iat" : 1311280970,
  "cnf" : {
    "kid" : b64'JDLUhTMjU2IiwiY3R5Ijoi ...'
  }
}
          </pre>
<p class="figure">Figure 24: Request and Response Payload for Introspection</p>
<p/>

<dl>
  <dt></dt>
  <dd style="margin-left: 8">C: Next, the client POSTs the access token to the /authz-info endpoint in the RS.  This is a plain CoAP request, i.e. no DTLS between client and RS.  Since the token is an opaque string, the RS cannot verify it on its own, and thus defers to respond the client with a status code until after step E.</dd>
  <dt></dt>
  <dd style="margin-left: 8">D: The RS forwards the token to the /introspect endpoint on the AS.  Introspection assumes a secure connection between the AS and the RS, e.g. using transport of application layer security. In the example AS is identified using pre shared security context (psk, rpk or certificate) while RS is acting as client and is identified with client_id and client_secret.  </dd>
  <dt></dt>
  <dd style="margin-left: 8">E: The AS provides the introspection response containing parameters about the token.  This includes the confirmation key (cnf) parameter that allows the RS to verify the client's proof of possession in step F.</dd>
  <dt></dt>
  <dd style="margin-left: 8">After receiving message E, the RS responds to the client's POST in step C with the CoAP response code 2.01 (Created).</dd>
  <dt></dt>
  <dd style="margin-left: 8"/>
  <dt></dt>
  <dd style="margin-left: 8">The information contained in the Request-Payload and the Response-Payload is shown in <a href="#fig:cOfflineIntroReq">Figure 24</a>.  </dd>
</dl>

<p> </p>
<p/>

<dl>
  <dt></dt>
  <dd style="margin-left: 8">The client uses the symmetric PoP key to establish a DTLS PreSharedKey secure connection to the RS. The CoAP request PUT is sent to the uri-path /state on RS changing state of the door to locked.  </dd>
  <dt></dt>
  <dd style="margin-left: 8">F: The RS responds with a appropriate over the secure DTLS channel.  </dd>
</dl>

<p> </p>
<div id="rfc.figure.25"/>
<div id="fig:cOfflineDTLSRequestAndResponse"/>
<pre>
           Resource
  Client    Server
    |         |
    |&lt;=======&gt;| DTLS Connection Establishment
    |         |   using Pre Shared Key
    |         |
    +--------&gt;| Header: PUT (Code=0.03)
    | PUT     | Uri-Path: "state"
    |         | Payload: &lt;new state for the lock&gt;
    |         |
F:  |&lt;--------+ Header: 2.04 Changed
    | 2.04    | Payload: &lt;new state for the lock&gt;
    |         |
            </pre>
<p class="figure">Figure 25: Resource request and response protected by OSCOAP</p>
<p/>
<h1 id="rfc.appendix.E"><a href="#rfc.appendix.E">Appendix E.</a> <a href="#app:changelog" id="app:changelog">Document Updates</a></h1>
<h1 id="rfc.appendix.E.1"><a href="#rfc.appendix.E.1">E.1.</a> <a href="#app:f3t4" id="app:f3t4">Version -02 to -03</a></h1>
<p/>

<ul>
  <li>Removed references to draft-ietf-oauth-pop-key-distribution since the status of this draft is unclear.</li>
  <li>Copied and adapted security considerations from draft-ietf-oauth-pop-key-distribution.</li>
  <li>Renamed "client information" to "RS information" since it is information about the RS.</li>
  <li>Clarified the requirements on profiles of this framework.</li>
  <li>Clarified the token endpoint protocol and removed negotiation of 'profile' and 'alg' (section 6).</li>
  <li>Renumbered the abbreviations for claims and parameters to get a consistent numbering across different endpoints.</li>
  <li>Clarified the introspection endpoint.</li>
  <li>Renamed token, introspection and authz-info to 'endpoint' instead of 'resource' to mirror the OAuth 2.0 terminology.</li>
  <li>Updated the examples in the appendices.</li>
</ul>
<h1 id="rfc.appendix.E.2"><a href="#rfc.appendix.E.2">E.2.</a> <a href="#app:f2t3" id="app:f2t3">Version -01 to -02</a></h1>
<p/>

<ul>
  <li>Restructured to remove communication security parts.  These shall now be defined in profiles.</li>
  <li>Restructured section 5 to create new sections on the OAuth endpoints /token, /introspect and /authz-info.</li>
  <li>Pulled in material from draft-ietf-oauth-pop-key-distribution in order to define proof-of-possession key distribution.</li>
  <li>Introduced the 'cnf' parameter as defined in RFC7800 to reference or transport keys used for proof of posession.</li>
  <li>Introduced the 'client-token' to transport client information from the AS to the client via the RS in conjunction with introspection.</li>
  <li>Expanded the IANA section to define parameters for token request, introspection and CWT claims.</li>
  <li>Moved deployment scenarios to the appendix as examples.</li>
</ul>
<h1 id="rfc.appendix.E.3"><a href="#rfc.appendix.E.3">E.3.</a> <a href="#app:f1t2" id="app:f1t2">Version -00 to -01</a></h1>
<p/>

<ul>
  <li>Changed 5.1. from "Communication Security Protocol" to "Client Information".</li>
  <li>Major rewrite of 5.1 to clarify the information exchanged between C and AS in the PoP token request profile for IoT.  <ul><li>Allow the client to indicate preferences for the communication security protocol.</li><li>Defined the term "Client Information" for the additional information returned to the client in addition to the access token.</li><li>Require that the messages between AS and client are secured, either with (D)TLS or with COSE_Encrypted wrappers.</li><li>Removed dependency on OSCoAP and added generic text about object security instead.</li><li>Defined the "rpk" parameter in the client information to transmit the raw public key of the RS from AS to client.</li><li>(D)TLS MUST use the PoP key in the handshake (either as PSK or as client RPK with client authentication).</li><li>Defined the use of x5c, x5t and x5tS256 parameters when a client certificate is used for proof of possession.</li><li>Defined "tktn" parameter for signaling for how to transfer the access token.</li></ul></li>
  <li>Added 5.2. the CoAP Access-Token option for transferring access tokens in messages that do not have payload.</li>
  <li>5.3.2. Defined success and error responses from the RS when receiving an access token.</li>
  <li>5.6.:Added section giving guidance on how to handle token expiration in the absence of reliable time.</li>
  <li>Appendix B Added list of roles and responsibilities for C, AS and RS.</li>
</ul>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ludwig Seitz</span> 
	  <span class="n hidden">
		<span class="family-name">Seitz</span>
	  </span>
	</span>
	<span class="org vcardline">SICS</span>
	<span class="adr">
	  <span class="vcardline">Scheelevaegen 17</span>

	  <span class="vcardline">
		<span class="locality">Lund</span>,  
		<span class="region"></span>
		<span class="code">223 70</span>
	  </span>
	  <span class="country-name vcardline">SWEDEN</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ludwig@sics.se">ludwig@sics.se</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Goeran Selander</span> 
	  <span class="n hidden">
		<span class="family-name">Selander</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span class="vcardline">Faroegatan 6</span>

	  <span class="vcardline">
		<span class="locality">Kista</span>,  
		<span class="region"></span>
		<span class="code">164 80</span>
	  </span>
	  <span class="country-name vcardline">SWEDEN</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:goran.selander@ericsson.com">goran.selander@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Erik Wahlstroem</span> 
	  <span class="n hidden">
		<span class="family-name">Wahlstroem</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:erik@wahlstromtekniska.se">erik@wahlstromtekniska.se</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Samuel Erdtman</span> 
	  <span class="n hidden">
		<span class="family-name">Erdtman</span>
	  </span>
	</span>
	<span class="org vcardline">Spotify AB</span>
	<span class="adr">
	  <span class="vcardline">Birger Jarlsgatan 61, 4tr</span>

	  <span class="vcardline">
		<span class="locality">Stockholm</span>,  
		<span class="region"></span>
		<span class="code">113 56</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:erdtman@spotify.com">erdtman@spotify.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Hannes Tschofenig</span> 
	  <span class="n hidden">
		<span class="family-name">Tschofenig</span>
	  </span>
	</span>
	<span class="org vcardline">ARM Ltd.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Hall in Tirol</span>,  
		<span class="region"></span>
		<span class="code">6060</span>
	  </span>
	  <span class="country-name vcardline">Austria</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Hannes.Tschofenig@arm.com">Hannes.Tschofenig@arm.com</a></span>

  </address>
</div>

</body>
</html>
